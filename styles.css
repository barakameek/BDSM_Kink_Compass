/* === KinkCompass Reimagined Styles === */

/* --- Root Variables & Themes --- */
:root {
  /* Color Palette (Light Theme - Default) */
  --bg-color: #fff0f5; /* Lavender blush - soft pink */
  --card-bg-color: #ffffff; /* White cards */
  --text-color: #4a2c3d; /* Dark eggplant */
  --text-color-light: #ffffff; /* For on accent backgrounds */
  --accent-color: #ff69b4; /* Hot pink */
  --accent-color-darker: #d14790; /* Darker hot pink */
  --accent-color-light: #ffa5d8; /* Lighter hot pink */
  --muted-text-color: #8a5a6d; /* Muted eggplant/rose */
  --border-color: #f4d4e4; /* Light pink border */
  --focus-ring-color: var(--accent-color-light);
  --focus-ring-alpha: 0.4;
  --success-color: #4CAF50;
  --danger-color: #f44336;
  --link-color: var(--accent-color);
  --link-hover-color: var(--accent-color-darker);
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 20%, transparent);
  --highlight-border-color: var(--accent-color-light);
  --loading-spinner-color: var(--accent-color);

  /* Shadows & Borders */
  --card-shadow: 0 5px 15px rgba(74, 44, 61, 0.1);
  --button-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  --input-shadow-inset: inset 0 1px 3px rgba(74, 44, 61, 0.08);
  --border-radius-medium: 15px;
  --border-radius-small: 10px;
  --border-width: 1px;
  --border-width-thick: 2px;

  /* Typography */
  --font-family-base: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  --font-size-base: 16px;
  --line-height-base: 1.6;

  /* Transitions */
  --transition-duration: 0.3s;
  --transition-timing: ease;

  /* Specific Component Variables */
  --chart-grid-color: rgba(74, 44, 61, 0.1);
  --chart-label-color: var(--muted-text-color);
  --chart-line-color: var(--accent-color);
  --chart-point-color: var(--accent-color-darker);
  --chart-tooltip-bg: rgba(0, 0, 0, 0.75);
  --chart-tooltip-text: #fff;

  /* Style Finder Specific */
  --sf-modal-bg: var(--card-bg-color);
  --sf-progress-color: var(--muted-text-color);
  --sf-dashboard-item-bg: color-mix(in srgb, var(--accent-color) 5%, transparent);
  --sf-slider-track-bg: var(--border-color);
  --sf-slider-footnote-color: var(--muted-text-color);
  --sf-popup-bg: var(--card-bg-color);
  --sf-score-delta-negative-color: var(--muted-text-color);

  /* Notification variables */
  --notification-info-bg: #2196F3;
  --notification-success-bg: var(--success-color);
  --notification-error-bg: var(--danger-color);
  --notification-warning-bg: #ff9800;
  --notification-achievement-bg: gold; /* NEW */
  --notification-text-light: #ffffff;
  --notification-text-dark: #000000;
}

/* --- Dark Theme --- */
body[data-theme="dark"] {
  --bg-color: #2a1b2a;
  --card-bg-color: #3c2f3c;
  --text-color: #f4d4e4;
  --text-color-light: #f4d4e4;
  --accent-color: #ff85cb;
  --accent-color-darker: #ff69b4;
  --accent-color-light: #e06ab0;
  --muted-text-color: #c49db1;
  --border-color: #5a3f5a;
  --focus-ring-color: var(--accent-color-light);
  --focus-ring-alpha: 0.5;
  --success-color: #66bb6a;
  --danger-color: #ef5350;
  --link-color: var(--accent-color);
  --link-hover-color: var(--accent-color-light);
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 15%, transparent);
  --highlight-border-color: var(--accent-color);
  --loading-spinner-color: var(--accent-color-light);

  --card-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
  --input-shadow-inset: inset 0 1px 3px rgba(0, 0, 0, 0.3);

  --chart-grid-color: rgba(244, 212, 228, 0.15);
  --chart-label-color: var(--muted-text-color);
  --chart-line-color: var(--accent-color);
  --chart-point-color: var(--accent-color-darker);
  --chart-tooltip-bg: rgba(255, 255, 255, 0.85);
  --chart-tooltip-text: #000;

  --sf-modal-bg: #3b233a;
  --sf-progress-color: #d8b8cb;
  --sf-dashboard-item-bg: rgba(248, 225, 233, 0.1);
  --sf-slider-track-bg: #5a3a56;
  --sf-slider-footnote-color: #d8b8cb;
  --sf-popup-bg: #3b233a;
  --sf-score-delta-negative-color: #d8b8cb;

  --notification-info-bg: #64b5f6;
  --notification-success-bg: var(--success-color);
  --notification-error-bg: var(--danger-color);
  --notification-warning-bg: #ffb74d;
  --notification-achievement-bg: gold;
  --notification-text-light: #000000; /* For dark mode success/error */
  --notification-text-dark: #ffffff; /* For dark mode warning/info */
}

/* --- Pastel Theme --- */
body[data-theme="pastel"] {
  --bg-color: #fdf6f9;
  --card-bg-color: #ffffff;
  --text-color: #6d5a6d;
  --accent-color: #a0d8ef; /* Soft blue */
  --accent-color-darker: #79b8d1;
  --accent-color-light: #c0e8f9;
  --muted-text-color: #b0a7b0;
  --border-color: #e8ddee;
  --focus-ring-color: var(--accent-color-light);
  --link-color: var(--accent-color-darker);
  --link-hover-color: #5a9cb0;
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 20%, transparent);
  --highlight-border-color: var(--accent-color-light);
  --loading-spinner-color: var(--accent-color);

  --sf-dashboard-item-bg: color-mix(in srgb, var(--accent-color) 10%, transparent);
  --sf-slider-track-bg: #e8ddee;
  --notification-achievement-bg: #f7dc6f; /* Pastel yellow for achievement */
  /* Use default light notification colors otherwise */
}

/* --- Velvet Theme --- */
body[data-theme="velvet"] {
  --bg-color: #1a122a;
  --card-bg-color: #2c1f3e;
  --text-color: #e8ddee;
  --accent-color: #dcc1ff; /* Light purple */
  --accent-color-darker: #b899e0;
  --accent-color-light: #c8a8f0;
  --muted-text-color: #a08cb0;
  --border-color: #4a3a5f;
  --focus-ring-color: var(--accent-color-light);
  --link-color: var(--accent-color);
  --link-hover-color: var(--accent-color-light);
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 15%, transparent);
  --highlight-border-color: var(--accent-color);
  --loading-spinner-color: var(--accent-color-light);

  --chart-grid-color: rgba(232, 221, 238, 0.15);
  --chart-label-color: var(--muted-text-color);
  --chart-line-color: var(--accent-color);
  --chart-point-color: var(--accent-color-darker);
  --chart-tooltip-bg: rgba(255, 255, 255, 0.8);
  --chart-tooltip-text: #000;

  --sf-modal-bg: #2c1f3e;
  --sf-progress-color: var(--muted-text-color);
  --sf-dashboard-item-bg: rgba(220, 193, 255, 0.1);
  --sf-slider-track-bg: #4a3a5f;
  --sf-slider-footnote-color: var(--muted-text-color);
  --sf-popup-bg: #2c1f3e;
  --sf-score-delta-negative-color: var(--muted-text-color);

  --notification-info-bg: #90caf9;
  --notification-success-bg: #81c784;
  --notification-error-bg: #e57373;
  --notification-warning-bg: #ffb74d;
  --notification-achievement-bg: #f4d03f; /* Velvet gold */
  --notification-text-light: #000000;
  --notification-text-dark: #ffffff;
}

/* --- General Styles & Resets --- */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body { font-family: var(--font-family-base); background-color: var(--bg-color); color: var(--text-color); line-height: var(--line-height-base); font-size: var(--font-size-base); transition: background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
h1, h2, h3, h4 { margin-bottom: 0.75em; color: var(--accent-color); line-height: 1.3; transition: color var(--transition-duration) var(--transition-timing); }
h1 { font-size: clamp(1.8em, 4vw, 2.4em); text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
h2 { font-size: clamp(1.5em, 3.5vw, 2em); }
h3 { font-size: clamp(1.2em, 3vw, 1.6em); margin-top: 1.5em; }
h4 { font-size: clamp(1.05em, 2.5vw, 1.25em); color: var(--text-color); margin-bottom: 0.5em; }
p { margin-bottom: 1em; }
ul, ol { list-style: none; margin-bottom: 1em; } /* Added ol */
dl { margin-bottom: 1em; }
dt { font-weight: bold; color: var(--accent-color); margin-top: 1em; font-size: 1.05em; }
dd { margin-left: 1.5em; margin-bottom: 0.5em; }
dd ul, dd ol { list-style: disc; padding-left: 1.5em; margin-top: 0.3em; } /* Added ol */
dd ol { list-style: decimal;} /* Ensure ordered lists use numbers */
a, .link-button { color: var(--link-color); text-decoration: none; transition: color var(--transition-duration) var(--transition-timing); cursor: pointer; }
a:hover, .link-button:hover { color: var(--link-hover-color); text-decoration: underline; }
.link-button { background: none; border: none; padding: 0; font: inherit; text-decoration: underline; }
*:focus-visible { outline: var(--border-width-thick) solid var(--focus-ring-color); outline-offset: 2px; box-shadow: 0 0 0 4px color-mix(in srgb, var(--focus-ring-color) calc(var(--focus-ring-alpha) * 100%), transparent); border-radius: 2px; }
*:focus:not(:focus-visible) { outline: none; }
hr { border: none; border-top: var(--border-width) dashed var(--border-color); margin: 1.5em 0; }

/* --- Layout & Structure --- */
.container { display: grid; grid-template-columns: repeat(auto-fit, minmax(min(100%, 340px), 1fr)); gap: 1.5em; padding: 1.5em; max-width: 1500px; margin: 1.5em auto; }
.card { background: var(--card-bg-color); padding: 1.5em; border-radius: var(--border-radius-medium); box-shadow: var(--card-shadow); border: var(--border-width) solid var(--border-color); transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), box-shadow var(--transition-duration) var(--transition-timing); }


/* --- Header --- */
.app-header { padding: 0.8em 1.5em; background: var(--accent-color); color: var(--text-color-light); display: flex; flex-wrap: wrap; justify-content: space-between; align-items: stretch; border-bottom: 3px solid color-mix(in srgb, var(--accent-color) 80%, black); box-shadow: 0 2px 8px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 500; transition: background-color var(--transition-duration) var(--transition-timing); min-height: 55px; }
.app-header h1 { margin: 0 1em 0 0; font-size: clamp(1.4em, 3vw, 1.8em); color: var(--text-color-light); text-shadow: 1px 1px 2px rgba(0,0,0,0.2); flex-shrink: 0; margin-bottom: 0; display: flex; align-items: center; }
.header-nav { display: flex; flex-wrap: wrap; gap: 0.6em; align-items: stretch; margin-left: auto; }
.header-btn { background: none; border: var(--border-width-thick) solid var(--text-color-light); color: var(--text-color-light); padding: 0.4em 0.8em; border-radius: var(--border-radius-small); cursor: pointer; font-size: clamp(0.75em, 1.5vw, 0.9em); font-weight: bold; transition: background-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease; white-space: nowrap; display: inline-flex; align-items: center; justify-content: center; text-align: center; }
.header-btn:hover, .header-btn:focus-visible { background: rgba(255, 255, 255, 0.2); transform: translateY(-1px); box-shadow: var(--button-shadow); }
.theme-btn { font-size: 1.2em; padding: 0.2em 0.5em; }

/* --- Form Section --- */
.form-section h2 { text-align: center; margin-bottom: 1.5em; }
.field-group { margin-bottom: 1.3em; }
.field-group label { display: block; font-weight: 600; margin-bottom: 0.5em; color: var(--accent-color); font-size: 0.95em; }
.field-group input[type="text"], .field-group select, .field-group textarea { width: 100%; padding: 0.8em 1em; font-size: 1em; border: var(--border-width) solid var(--border-color); border-radius: var(--border-radius-small); background: var(--bg-color); color: var(--text-color); transition: border-color var(--transition-duration) var(--transition-timing), background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing), box-shadow var(--transition-duration) var(--transition-timing); box-shadow: var(--input-shadow-inset); accent-color: var(--accent-color); } /* Added accent-color */
.field-group input[type="text"]:focus, .field-group select:focus, .field-group textarea:focus { border-color: var(--accent-color); background-color: var(--card-bg-color); }
.field-group select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%238a5a6d' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.414l-4.707-4.707a1 1 0 011.414-1.414L8 8.586l3.293-3.293a1 1 0 111.414 1.414L8 11.414z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.8em center; background-size: 1em; padding-right: 2.5em; }
body[data-theme="dark"] .field-group select, body[data-theme="velvet"] .field-group select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23c49db1' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.414l-4.707-4.707a1 1 0 011.414-1.414L8 8.586l3.293-3.293a1 1 0 111.414 1.414L8 11.414z'/%3E%3C/svg%3E"); }
body[data-theme="pastel"] .field-group select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23b0a7b0' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.414l-4.707-4.707a1 1 0 011.414-1.414L8 8.586l3.293-3.293a1 1 0 111.414 1.414L8 11.414z'/%3E%3C/svg%3E"); }
.field-group textarea { resize: vertical; min-height: 80px; }
.style-helpers { display: flex; align-items: center; gap: 0.8em; margin-top: 0.5em; font-size: 0.85em; } /* NEW container */
.explore-style-link { /* NEW */ font-style: italic; color: var(--muted-text-color); }
.explore-style-link:hover { color: var(--link-hover-color); }

/* Avatar Picker */
/* (Keep existing Avatar Picker styles) */
.avatar-picker-fieldset { border: none; padding: 0; margin: 0; margin-top: 0.5em; }
.avatar-picker-fieldset legend { /* ... */ }
.avatar-picker { /* ... */ }
#avatar-display { /* ... */ }
.avatar-btn { /* ... */ }
.avatar-btn:hover { /* ... */ }
.avatar-btn.selected { /* ... */ }
.avatar-btn:focus-visible { /* ... */ }

/* Traits Area */
#traits-message { /* NEW */
  margin-top: 1.5em;
  padding: 1em;
  background-color: var(--bg-color);
  border: var(--border-width) dashed var(--border-color);
  border-radius: var(--border-radius-small);
  text-align: center;
  transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
}
#traits-container { margin-top: 1.5em; border-top: var(--border-width) dashed var(--border-color); padding-top: 1.5em; position: relative; transition: border-color var(--transition-duration) var(--transition-timing); }
#traits-container:empty { border-top: none; padding-top: 0; margin-top: 0;} /* Hide border if empty */

/* Individual Trait Styling */
/* (Keep existing Trait styles) */
.trait { /* ... */ }
.trait label { /* ... */ }
.trait-info-btn { /* ... */ }
.trait input[type="range"].trait-slider { /* ... */ accent-color: var(--accent-color); /* Ensure theme color */ }
.trait input[type="range"].trait-slider:active { /* ... */ }
.trait-value { /* ... */ }
.trait-desc { /* ... */ }

/* Trait Info & Context Help Popups */
.trait-info-popup, .context-help-popup { /* NEW: Combined styles */
  display: none; /* Controlled by JS */
  position: fixed; /* Changed from absolute */
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 450px;
  z-index: 1010; /* Higher than modal backdrop */
  padding: 1.8em;
  border: var(--border-width-thick) solid var(--accent-color);
  background-color: var(--card-bg-color);
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  border-radius: var(--border-radius-medium);
  transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), opacity 0.2s ease;
  opacity: 1;
}
.context-help-popup { max-width: 400px; padding: 1.5em; } /* Slightly smaller help popup */
.trait-info-popup h4, .context-help-popup h4 { margin-top: 0; text-align: center; color: var(--accent-color); }
#trait-info-body p, #context-help-body p { margin-bottom: 0.8em; font-size: 0.95em; line-height: 1.5; }
#trait-info-body strong { color: var(--accent-color-darker); }
.popup-close { /* NEW: Common style for popup closes */
    position: absolute;
    top: 8px;
    right: 10px;
    background: none;
    border: none;
    font-size: 1.8em;
    line-height: 1;
    color: var(--muted-text-color);
    cursor: pointer;
    padding: 0.1em 0.3em;
    transition: color 0.2s ease, transform 0.2s ease;
}
.popup-close:hover { color: var(--accent-color); transform: scale(1.1) rotate(90deg); }

/* Form Actions (Save/Clear Buttons) */
.form-actions { display: flex; flex-wrap: wrap; gap: 1em; margin-top: 1.8em; justify-content: center; }
.save-btn, .clear-btn { border: none; padding: 0.8em 1.8em; font-size: 1.1em; border-radius: 50px; cursor: pointer; font-weight: bold; transition: transform 0.2s ease, background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.5em; } /* Added flex for spinner */
.save-btn { background: var(--accent-color); color: var(--text-color-light); }
.save-btn:hover:not(:disabled) { background: var(--accent-color-darker); transform: translateY(-2px); box-shadow: var(--button-shadow); }
.clear-btn { background: var(--muted-text-color); color: var(--card-bg-color); }
.clear-btn:hover:not(:disabled) { background: var(--text-color); transform: translateY(-2px); box-shadow: var(--button-shadow); }
.save-btn:disabled, .clear-btn:disabled { background: color-mix(in srgb, var(--muted-text-color) 70%, transparent); color: color-mix(in srgb, var(--text-color-light) 70%, transparent); cursor: wait; /* Changed cursor */ transform: none; box-shadow: none; opacity: 0.7; }

/* --- List Section --- */
.list-section h2 { text-align: center; }
#people-list li { /* (Keep existing styles) */ }
#people-list li:hover, #people-list li:focus-within { /* (Keep existing styles) */ }
#people-list li:focus-within { /* (Keep existing styles) */ }
.person-info { /* ... */ }
.person-avatar { /* ... */ }
.person-name-details { /* ... */ }
.person-name { /* ... */ }
.person-details { /* ... */ }
.person-actions { /* ... */ }

/* Small buttons (Edit/Delete in list, Goals etc) */
.small-btn { background: var(--accent-color); color: var(--text-color-light); border: none; padding: 0.4em 0.8em; border-radius: 15px; cursor: pointer; font-size: 0.85em; transition: background-color 0.2s ease, transform 0.1s ease; line-height: 1.2; display: inline-flex; align-items: center; justify-content: center; }
.small-btn:hover:not(:disabled) { background: var(--accent-color-darker); transform: scale(1.05); }
.delete-btn { background: var(--danger-color); }
.delete-btn:hover:not(:disabled) { background: color-mix(in srgb, var(--danger-color) 80%, black); }
.context-help-btn { /* NEW */
    background: none;
    border: 1px solid var(--muted-text-color);
    color: var(--muted-text-color);
    border-radius: 50%;
    width: 22px;
    height: 22px;
    font-size: 0.9em;
    font-weight: bold;
    padding: 0;
    line-height: 1;
}
.context-help-btn:hover {
    background: var(--bg-color);
    border-color: var(--accent-color);
    color: var(--accent-color);
    transform: scale(1.1);
}

/* --- Preview Section --- */
/* (Keep existing Preview styles) */
.preview-section { /* ... */ }
.preview-section h2 { /* ... */ }
#live-preview { /* ... */ }
.preview-title { /* ... */ }
.preview-breakdown { /* ... */ }
.core-trait-preview ul, .top-trait-preview { /* ... */ }
.core-trait-preview li { /* ... */ }
.core-trait-preview li strong, .top-trait-preview strong { /* ... */ }
.top-trait-preview hr { /* ... */ }
.top-trait-preview p { /* ... */ }


/* --- Modals (General) --- */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.65); backdrop-filter: blur(3px); display: flex; align-items: center; justify-content: center; padding: 1em; overflow-y: auto; }
.modal[aria-hidden="true"] { display: none; }
.modal[aria-hidden="false"] { display: flex; }
.modal-content { position: relative; background: var(--card-bg-color); padding: 2em; border-radius: var(--border-radius-medium); border: var(--border-width-thick) solid var(--accent-color); max-width: 95%; width: 700px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.25); transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing); animation: modalFadeIn 0.3s ease; display: flex; flex-direction: column; } /* Added flex column */
.modal-content.wide-modal { width: 900px; }
.modal-close { position: absolute; top: 12px; right: 15px; background: none; border: none; font-size: 2em; line-height: 1; color: var(--muted-text-color); cursor: pointer; padding: 0.1em 0.3em; transition: color 0.2s ease, transform 0.2s ease; z-index: 10; } /* Ensure close is above tabs */
.modal-close:hover { color: var(--accent-color); transform: scale(1.15) rotate(90deg); }
.modal h2 { margin-top: 0; text-align: center; color: var(--accent-color); padding-right: 30px; } /* Add padding for close button */

@keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

/* --- Persona Detail Modal --- */
#detail-modal .modal-content { width: 800px; max-width: 95%; } /* Slightly wider default */
.modal-title { font-size: 1.8em; margin-bottom: 0.2em; text-align: center; }
.modal-subtitle { text-align: center; margin-top: 0.2em; margin-bottom: 1em; color: var(--muted-text-color); font-weight: bold; font-size: 1.05em; }
.modal-intro { font-style: italic; color: var(--accent-color-darker); text-align: center; margin: -0.5em auto 1.5em auto; font-size: 1.1em; max-width: 80%;}

/* Detail Modal Tabs - NEW */
.modal-tabs {
  display: flex;
  flex-wrap: wrap; /* Allow wrapping on small screens */
  border-bottom: var(--border-width-thick) solid var(--border-color);
  margin: 0 -2em 1.5em -2em; /* Extend to edges of modal padding */
  padding: 0 1.5em;
  flex-shrink: 0; /* Prevent tabs shrinking */
}
.tab-link {
  background: none;
  border: none;
  border-bottom: 3px solid transparent;
  padding: 0.8em 1.2em;
  cursor: pointer;
  font-size: 0.95em;
  font-weight: 600;
  color: var(--muted-text-color);
  transition: color 0.2s ease, border-color 0.2s ease;
  margin-bottom: -2px; /* Overlap border */
  white-space: nowrap;
}
.tab-link:hover {
  color: var(--accent-color-darker);
}
.tab-link.active {
  color: var(--accent-color);
  border-bottom-color: var(--accent-color);
}
.tab-link:focus-visible { /* Adjust focus slightly for tabs */
   outline-offset: -2px;
   background-color: var(--highlight-bg-color);
}

/* Detail Modal Tab Content - NEW */
#modal-body { padding: 0.5em; flex-grow: 1; overflow-y: auto; /* Allow body content to scroll independently */}
.tab-content {
  display: none; /* Hidden by default */
  padding: 0.5em 0.2em; /* Add some padding within content panes */
  animation: modalFadeIn 0.4s ease forwards; /* Fade in content */
}
.tab-content.active {
  display: block; /* Show active tab */
}
.tab-content section { /* Style sections within tabs */
    margin-top: 0; /* Remove default top margin */
    margin-bottom: 1.8em;
    padding: 1.5em;
    border: var(--border-width) solid var(--border-color);
    border-radius: var(--border-radius-small);
    background-color: color-mix(in srgb, var(--card-bg-color) 95%, var(--bg-color));
    box-shadow: 0 2px 5px rgba(74, 44, 61, 0.05);
    transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
}
.tab-content section:last-child { margin-bottom: 0.5em; } /* Reduce bottom margin of last section */
.tab-content section h3 {
    margin-top: 0;
    margin-bottom: 1em;
    padding-bottom: 0.6em;
    border-bottom: var(--border-width) dashed var(--accent-color);
    display: flex;
    align-items: center;
    justify-content: space-between; /* Allow button to go right */
    gap: 0.6em;
    font-size: 1.3em;
    transition: border-color var(--transition-duration) var(--transition-timing);
}
.loading-text { /* NEW */
  text-align: center;
  padding: 2em;
  color: var(--muted-text-color);
  font-style: italic;
}
.error-text { /* NEW */
  text-align: center;
  padding: 2em;
  color: var(--danger-color);
  font-weight: bold;
}

/* Goals Section (Detail Modal) */
/* (Keep existing Goal styles, ensure they work within tab content) */
.goals-section ul { /* ... */ }
.goals-section li { /* ... */ }
.goals-section li::before { /* ... */ }
.goals-section li.done { /* ... */ }
.goals-section li.done::before { /* ... */ }
.goals-section li > span:first-child { /* ... */ }
.goal-actions button { /* ... */ }
.add-goal-form { /* ... */ }
.add-goal-form input { /* ... */ }
.add-goal-form button { /* ... */ }

/* Style Breakdown (Detail Modal) */
/* (Keep existing Breakdown styles) */
.style-breakdown { /* ... */ }
.style-breakdown .strengths, .style-breakdown .improvements { /* ... */ }
.style-breakdown h4 { /* ... */ }

/* Trait Details Grid (Detail Modal) */
/* (Keep existing Trait Grid styles) */
.trait-details-grid { /* ... */ }
.trait-detail-item { /* ... */ }
.trait-detail-item h4 { /* ... */ }
.trait-detail-item h4 a { color: inherit; } /* Ensure links inherit color */
.trait-detail-item h4 a:hover { color: var(--link-hover-color); }
.trait-detail-item p { /* ... */ }
.trait-detail-item p:last-child { /* ... */ }
.trait-detail-item strong { /* ... */ }
.trait-detail-item em { /* ... */ }

/* History Section (Detail Modal) */
/* (Keep existing History styles) */
.history-section h3 { /* Ensure button alignment works */ }
.snapshot-info-btn { /* ... */ }
.snapshot-info { /* ... */ }
.history-chart-container{ max-width: 100%; /* Allow chart to fill width */ margin: 1.8em auto 1.2em auto; position: relative; height: 320px; }
#history-chart { display: block; width: 100% !important; height: 100% !important; }
#snapshot-btn { display: block; margin: 1.2em auto 0 auto; }
.history-chart-container.chart-loading::after { /* NEW: Loading state */
    content: 'Loading Chart...';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(var(--card-bg-color-rgb, 255, 255, 255), 0.8); /* Use RGB version if possible */
    color: var(--muted-text-color);
    font-style: italic;
    z-index: 5;
}
body[data-theme="dark"] .history-chart-container.chart-loading::after,
body[data-theme="velvet"] .history-chart-container.chart-loading::after {
    background: rgba(var(--card-bg-color-rgb, 44, 31, 62), 0.8);
}

/* Achievements Section (Detail Modal) */
.achievements-section ul { display: flex; flex-wrap: wrap; gap: 1em; margin-top: 0.8em; padding-left: 0; justify-content: center; }
.achievements-section li { background: var(--bg-color); border: var(--border-width) solid var(--border-color); padding: 0.6em 1.2em; border-radius: var(--border-radius-medium); text-align: center; display: flex; flex-direction: column; align-items: center; gap: 0.3em; min-width: 110px; transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), transform 0.1s ease; }
.achievements-section li:hover { transform: translateY(-2px); border-color: var(--accent-color-light); }
.achievement-icon { font-size: 1.6em; line-height: 1; }
.achievement-name { font-weight: bold; font-size: 0.85em; }

/* Kink Reading Section (Detail Modal) */
.kink-reading-section h3 { /* Ensure button alignment */ }
#reading-btn { margin-left: 0; /* Reset margin if needed */ }
.kink-reading-output { /* (Keep existing styles) */ }

/* Reflections Section (Detail Modal) */
.reflections-section .modal-actions { margin-bottom: 1.2em; text-align: center; }
.reflections-textarea { display: block; width: 100%; min-height: 150px; margin-bottom: 1.2em; line-height: 1.7; }
#save-reflections-btn { display: block; margin: 0 auto; }
.journal-prompt { /* (Keep existing styles) */ }

/* --- Achievements Modal --- NEW */
#achievements-modal .modal-content { width: 900px; max-width: 95%; }
#achievements-body h2 { margin-bottom: 0.5em; }
#achievements-body > p { text-align: center; margin-bottom: 1.5em; font-size: 0.95em; color: var(--muted-text-color); }
.all-achievements-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.2em;
  padding: 0;
  margin-top: 1em;
}
.all-achievements-list li {
  background: var(--bg-color);
  border: var(--border-width) solid var(--border-color);
  border-left: 5px solid var(--muted-text-color);
  padding: 1.2em;
  border-radius: var(--border-radius-small);
  display: flex;
  align-items: center;
  gap: 1em;
  transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
}
.all-achievements-list li.locked {
  opacity: 0.6;
  border-left-color: color-mix(in srgb, var(--muted-text-color) 50%, transparent);
}
.all-achievements-list li.unlocked {
  border-left-color: gold; /* Specific color for unlocked */
}
body[data-theme="dark"] .all-achievements-list li.unlocked,
body[data-theme="velvet"] .all-achievements-list li.unlocked {
   border-left-color: #f4d03f;
}
.all-achievements-list .achievement-icon {
  font-size: 2.2em;
  flex-shrink: 0;
}
.all-achievements-list .achievement-details {
  display: flex;
  flex-direction: column;
}
.all-achievements-list .achievement-name {
  font-weight: bold;
  font-size: 1.05em;
  color: var(--accent-color-darker);
  margin-bottom: 0.2em;
}
.all-achievements-list li.locked .achievement-name {
    color: var(--text-color); /* Less prominent for locked */
}
.all-achievements-list .achievement-desc {
  font-size: 0.9em;
  color: var(--text-color);
  line-height: 1.5;
}
.all-achievements-list li.locked .achievement-desc {
    color: var(--muted-text-color);
    font-style: italic;
}


/* --- Other Auxiliary Modals --- */
/* (Keep existing styles for Resources, Glossary, Style Discovery, Themes) */
#resources-modal dl dt { /* ... */ }
#resources-modal dl dd { /* ... */ }
#glossary-body dl dt { /* ... */ }
#glossary-body dl dd { /* ... */ }
#glossary-body .related-terms { /* ... */ }
#glossary-body .related-terms a { /* ... */ }
#glossary-body .related-terms a:hover { /* ... */ }
.style-discovery-controls { /* ... */ }
#style-discovery-body { max-height: 65vh; overflow-y: auto; padding-right: 0.8em; margin-top: 1em;}
.style-discovery-item { /* ... */ }
.style-discovery-item h4 { /* ... */ }
.style-discovery-item p { /* ... */ }
.style-discovery-item ul { /* ... */ }
.style-discovery-item li { /* ... */ }
.theme-options { /* ... */ }
.theme-option-btn { /* ... */ }
.theme-option-btn:hover { /* ... */ }
/* Theme button specific colors */
.theme-option-btn[data-theme=light] { /* ... */ }
.theme-option-btn[data-theme=dark] { /* ... */ }
.theme-option-btn[data-theme=pastel] { /* ... */ }
.theme-option-btn[data-theme=velvet] { /* ... */ }

/* --- Highlighting --- NEW */
.highlighted-term { /* For Glossary */
  background-color: var(--highlight-bg-color);
  border: 1px dashed var(--highlight-border-color);
  padding: 0.2em 0.4em;
  margin: -0.2em -0.4em;
  border-radius: 4px;
  display: inline-block; /* Keep highlight tight */
  scroll-margin-top: 20px; /* Ensure space when scrolled to */
}
.highlighted-style { /* For Style Discovery */
  background-color: var(--highlight-bg-color);
  border: 1px solid var(--highlight-border-color);
  box-shadow: 0 0 10px var(--highlight-bg-color);
  scroll-margin-top: 20px; /* Ensure space when scrolled to */
}

/* --- Style Finder Specific Styles --- */
/* (Keep existing SF styles, ensure dashboard toggle button fits) */
.sf-modal .sf-modal-content { /* ... */ }
.sf-modal-content h3 { /* ... */ }
#sf-close-style-finder { /* ... */ }
#sf-progress-tracker { /* ... */ }
#sf-step-content { padding: 0.5em 0; position: relative; /* For loading overlay */}
#sf-step-content.loading::after { /* NEW: Loading state */
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(var(--card-bg-color-rgb, 255, 255, 255), 0.7);
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
}
body[data-theme="dark"] #sf-step-content.loading::after,
body[data-theme="velvet"] #sf-step-content.loading::after {
    background: rgba(var(--card-bg-color-rgb, 44, 31, 62), 0.7);
}
#sf-step-content h2 { /* ... */ }
#sf-step-content p { /* ... */ }
#sf-step-content button { /* ... */ }
#sf-step-content button:hover:not(:disabled) { /* ... */ }
#sf-step-content .sf-button-container { /* ... */ }
#sf-step-content button[data-action="prev"] { /* ... */ }
#sf-step-content button[data-action="prev"]:hover:not(:disabled) { /* ... */ }
#sf-feedback { /* ... */ }
#sf-dashboard { /* ... */ }
.sf-dashboard-header { /* ... */ }
.sf-dashboard-item { /* ... */ }
.sf-style-name { /* ... */ }
.sf-dashboard-score { /* ... */ }
body[data-theme="dark"] .sf-dashboard-score, body[data-theme="velvet"] .sf-dashboard-score { /* ... */ }
.sf-move-up, .sf-move-down { /* ... */ }
.sf-score-delta { /* ... */ }
.sf-score-delta.positive { /* ... */ }
body[data-theme="dark"] .sf-score-delta.positive, body[data-theme="velvet"] .sf-score-delta.positive { /* ... */ }
.sf-score-delta.negative { /* ... */ }
.sf-trait-slider { /* ... */ accent-color: var(--accent-color); }
.sf-trait-slider:active { /* ... */ }
.sf-trait-slider::-webkit-slider-thumb { /* ... */ }
.sf-trait-slider::-moz-range-thumb { /* ... */ }
.sf-trait-slider::-webkit-slider-thumb:hover { /* ... */ }
.sf-trait-slider::-moz-range-thumb:hover { /* ... */ }
.sf-slider-description { /* ... */ }
.sf-slider-footnote { /* ... */ }
.sf-info-icon { /* ... */ }
.sf-info-icon:hover { /* ... */ }
/* Info Popups */
.sf-style-info-popup { /* ... */ }
.sf-style-info-popup.wide-popup { /* ... */ }
.sf-style-info-popup h3 { /* ... */ }
.sf-style-info-popup p { /* ... */ }
.sf-style-info-popup ul { /* ... */ }
.sf-style-info-popup li { /* ... */ }
.sf-style-info-popup h4 { /* ... */ }
.sf-close-btn { /* ... */ }
.sf-close-btn:hover { /* ... */ }

/* Result Section */
.sf-result-section { /* ... */ }
.sf-result-heading { /* ... */ }
.sf-result-section p { /* ... */ }
.sf-result-section h3 { /* ... */ }
.sf-result-section ul { /* ... */ }
.sf-result-buttons { /* ... */ }
.sf-result-buttons button[data-action="applyStyle"] { /* ... */ }
.sf-result-buttons button[data-action="applyStyle"]:hover:not(:disabled) { /* ... */ }


/* --- Animations & Effects --- */
/* (Keep existing SF animations: sfFadeIn, sfBounce, sfSlideIn, sfFadeOut) */
@keyframes sfFadeIn { /* ... */ }
@keyframes sfBounce { /* ... */ }
@keyframes sfSlideIn { /* ... */ }
@keyframes sfFadeOut { /* ... */ }

/* NEW: Spinner Animation */
.spinner {
  display: inline-block;
  border: 3px solid color-mix(in srgb, var(--loading-spinner-color) 30%, transparent);
  border-radius: 50%;
  border-top-color: var(--loading-spinner-color);
  width: 1em;
  height: 1em;
  animation: spin 1s linear infinite;
  vertical-align: middle;
  margin-left: 0.5em; /* Space it from button text */
}
@keyframes spin { to { transform: rotate(360deg); } }
button.loading .spinner { /* Adjust spinner color for loading buttons */
    border: 3px solid rgba(255,255,255,0.3);
    border-top-color: #fff;
}

/* NEW: Saving Indication Animation */
@keyframes briefHighlight {
  0%, 100% { background-color: var(--bg-color); border-color: var(--border-color); }
  30%, 70% { background-color: var(--highlight-bg-color); border-color: var(--highlight-border-color); }
}
.item-just-saved { /* For list items */
  animation: briefHighlight 1.5s ease-out;
}
@keyframes briefInputBorder {
  0%, 100% { border-color: var(--border-color); }
  30%, 70% { border-color: var(--success-color); }
}
.input-just-saved { /* For textarea/input */
   animation: briefInputBorder 1.5s ease-out;
}

/* --- Footer --- */
.app-footer { /* (Keep existing Footer styles) */ }
.app-footer small { /* ... */ }

/* --- Utility Classes --- */
.muted-text { /* (Keep existing muted-text styles) */ }

/* --- Notification Styles --- */
#app-notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 8px; z-index: 2000; opacity: 0; transition: opacity 0.5s ease, top 0.5s ease, background-color 0.3s ease, color 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 0.95em; text-align: center; pointer-events: none; max-width: 80%; }
.notification-success { background-color: var(--notification-success-bg, var(--success-color)); color: var(--notification-text-light, white); }
.notification-error { background-color: var(--notification-error-bg, var(--danger-color)); color: var(--notification-text-light, white); }
.notification-warning { background-color: var(--notification-warning-bg, #ff9800); color: var(--notification-text-dark, black); }
.notification-info { background-color: var(--notification-info-bg, var(--accent-color)); color: var(--notification-text-light, white); }
.notification-achievement { /* NEW */
    background-color: var(--notification-achievement-bg, gold);
    color: var(--notification-text-dark, black);
    font-weight: bold;
    border: 2px solid color-mix(in srgb, var(--notification-achievement-bg, gold) 80%, black);
}


/* --- Responsiveness --- */
@media (max-width: 900px) {
    .modal-content.wide-modal { width: 90%; }
    #detail-modal .modal-content { width: 90%; } /* Adjust detail modal width */
    .sf-style-info-popup.wide-popup { max-width: 90%; }
    .all-achievements-list { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); } /* Adjust achievement grid */
}
@media (max-width: 768px) {
    .container { padding: 1em; gap: 1em; }
    .card { padding: 1.2em; }
    .app-header { padding: 0.8em 1em; }
    .app-header h1 { font-size: clamp(1.3em, 4vw, 1.6em); }
    .header-nav { gap: 0.4em; align-items: center; }
    .header-btn { height: auto; padding: 0.3em 0.6em; font-size: clamp(0.7em, 1.8vw, 0.8em); }
    .theme-btn { font-size: 1.1em;}
    .modal-content { padding: 1.5em; max-width: 95%; width: auto; }
    .form-actions { flex-direction: column; }
    .trait-details-grid { grid-template-columns: 1fr; }
    .sf-modal .sf-modal-content { max-width: 95%; padding: 20px; }
    #sf-step-content h2 { font-size: 1.25em; }
    .modal-tabs { margin-left: -1.5em; margin-right: -1.5em; padding: 0 1em; overflow-x: auto; } /* Allow horizontal scroll */
    .tab-link { padding: 0.7em 0.9em; font-size: 0.9em; }
    .all-achievements-list { grid-template-columns: 1fr; } /* Stack achievements */
}
@media (max-width: 480px) {
    body { font-size: 15px; }
    .app-header { flex-direction: column; align-items: flex-start; }
    .app-header h1 { margin-bottom: 0.5em; width: 100%; text-align: center; }
    .header-nav { margin-left: 0; width: 100%; justify-content: space-around; gap: 0.5em; }
    .header-btn { padding: 0.5em 0.8em; }
    .container { grid-template-columns: 1fr; padding: 0.8em; gap: 0.8em; }
    .card { padding: 1em; }
    .modal-content { padding: 1.2em; }
    .form-actions { gap: 0.8em; }
    .save-btn, .clear-btn { font-size: 1em; padding: 0.7em 1.5em; }
    .sf-modal .sf-modal-content { padding: 15px; }
    .sf-modal-content h3 { font-size: 1.4em; }
    #sf-step-content h2 { font-size: 1.15em; flex-direction: column; gap: 0.2em; }
    .sf-trait-slider { max-width: 95%; }
    .sf-slider-description { font-size: 0.9em; padding: 8px 10px; min-height: 2.5em; }
    .sf-slider-footnote { font-size: 0.8em; }
    .sf-style-info-popup { max-width: 95%; padding: 15px; }
    .sf-style-info-popup h3 { font-size: 1.2em; }
    .sf-result-section ul { max-width: 90%; }
    #sf-step-content button { padding: 0.7em 1.4em; font-size: 0.95em; }
    .sf-result-buttons { gap: 8px; }
    .tab-link { padding: 0.6em 0.8em; font-size: 0.85em; }
    .all-achievements-list li { flex-direction: column; text-align: center; gap: 0.5em; padding: 1em; }
    .all-achievements-list .achievement-icon { font-size: 2em; }
}

/* --- END OF FILE styles.css --- */
