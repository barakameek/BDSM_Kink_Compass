
:root {
  /* Color Palette (Light Theme - Default) */
  --bg-color: #fff0f5; /* Lavender blush - soft pink */
  --card-bg-color: #ffffff; /* White cards */
  --text-color: #4a2c3d; /* Dark eggplant */
  --text-color-light: #ffffff; /* For on accent backgrounds */
  --accent-color: #ff69b4; /* Hot pink */
  --accent-color-darker: #d14790; /* Darker hot pink */
  --accent-color-light: #ffa5d8; /* Lighter hot pink */
  --accent-color-lighter: #ffe0f0; /* Even lighter pink for subtle highlights */
  --muted-text-color: #8a5a6d; /* Muted eggplant/rose */
  --border-color: #f4d4e4; /* Light pink border */
  --focus-ring-color: var(--accent-color-light);
  --focus-ring-alpha: 0.4;
  --success-color: #4CAF50;
  --danger-color: #f44336;
  --warning-color: #ff9800;
  --info-color: #2196F3;
  --achievement-color: gold;
  --link-color: var(--accent-color);
  --link-hover-color: var(--accent-color-darker);
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 20%, transparent);
  --highlight-border-color: var(--accent-color-light);
  --loading-spinner-color: var(--accent-color);

  /* Shadows & Borders */
  --card-shadow: 0 5px 15px rgba(74, 44, 61, 0.1);
  --button-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  --input-shadow-inset: inset 0 1px 3px rgba(74, 44, 61, 0.08);
  --border-radius-medium: 15px;
  --border-radius-small: 10px;
  --border-width: 1px;
  --border-width-thick: 2px;

  /* Typography */
  --font-family-base: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  --font-size-base: 16px;
  --line-height-base: 1.6;

  /* Transitions */
  --transition-duration: 0.3s;
  --transition-timing: ease;

  /* Specific Component Variables */
  --chart-grid-color: rgba(74, 44, 61, 0.1);
  --chart-label-color: var(--muted-text-color);
  --chart-line-color: var(--accent-color);
  --chart-point-color: var(--accent-color-darker);
  --chart-tooltip-bg: rgba(0, 0, 0, 0.75);
  --chart-tooltip-text: #fff;

  /* Style Finder Specific */
  --sf-modal-bg: var(--card-bg-color);
  --sf-progress-color: var(--muted-text-color);
  --sf-dashboard-item-bg: color-mix(in srgb, var(--accent-color) 5%, transparent);
  --sf-slider-track-bg: var(--border-color);
  --sf-slider-footnote-color: var(--muted-text-color);
  --sf-popup-bg: var(--card-bg-color);
  --sf-score-delta-negative-color: var(--muted-text-color);

  /* Notification variables */
  --notification-info-bg: var(--info-color);
  --notification-success-bg: var(--success-color);
  --notification-error-bg: var(--danger-color);
  --notification-warning-bg: var(--warning-color);
  --notification-achievement-bg: var(--achievement-color);
  --notification-text-light: #ffffff;
  --notification-text-dark: #000000; /* For light backgrounds like yellow/gold */

   /* Define RGB versions for rgba fallbacks */
   --card-bg-color-rgb: 255, 255, 255;
}

/* --- Dark Theme --- */
html[data-theme="dark"] { /* Use html attribute for theme */
  --bg-color: #2a1b2a;
  --card-bg-color: #3c2f3c;
  --text-color: #f4d4e4;
  --text-color-light: #f4d4e4; /* Light text for accent bg */
  --accent-color: #ff85cb; /* Brighter pink for dark bg */
  --accent-color-darker: #ff69b4;
  --accent-color-light: #e06ab0;
  --accent-color-lighter: #4f3f4f; /* Darker highlight */
  --muted-text-color: #c49db1;
  --border-color: #5a3f5a;
  --focus-ring-color: var(--accent-color-light);
  --focus-ring-alpha: 0.5;
  --success-color: #66bb6a;
  --danger-color: #ef5350;
  --warning-color: #ffb74d;
  --info-color: #64b5f6;
  --achievement-color: gold;
  --link-color: var(--accent-color);
  --link-hover-color: var(--accent-color-light);
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 15%, transparent);
  --highlight-border-color: var(--accent-color);
  --loading-spinner-color: var(--accent-color-light);

  --card-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
  --input-shadow-inset: inset 0 1px 3px rgba(0, 0, 0, 0.3);

  --chart-grid-color: rgba(244, 212, 228, 0.15);
  --chart-label-color: var(--muted-text-color);
  --chart-line-color: var(--accent-color);
  --chart-point-color: var(--accent-color-darker);
  --chart-tooltip-bg: rgba(255, 255, 255, 0.85);
  --chart-tooltip-text: #000;

  --sf-modal-bg: #3b233a;
  --sf-progress-color: #d8b8cb;
  --sf-dashboard-item-bg: rgba(248, 225, 233, 0.1);
  --sf-slider-track-bg: #5a3a56;
  --sf-slider-footnote-color: #d8b8cb;
  --sf-popup-bg: #3b233a;
  --sf-score-delta-negative-color: #d8b8cb;

  --notification-info-bg: var(--info-color);
  --notification-success-bg: var(--success-color);
  --notification-error-bg: var(--danger-color);
  --notification-warning-bg: var(--warning-color);
  --notification-achievement-bg: var(--achievement-color);
  --notification-text-light: #000000; /* Dark text for gold */
  --notification-text-dark: #ffffff; /* Light text for others */

   --card-bg-color-rgb: 60, 47, 60;
}

/* --- Pastel Theme --- */
html[data-theme="pastel"] { /* Use html attribute for theme */
  --bg-color: #fdf6f9;
  --card-bg-color: #ffffff;
  --text-color: #6d5a6d;
  --text-color-light: #6d5a6d; /* Darker text for accent bg */
  --accent-color: #a0d8ef; /* Soft blue */
  --accent-color-darker: #79b8d1;
  --accent-color-light: #c0e8f9;
  --accent-color-lighter: #e0f4fc;
  --muted-text-color: #b0a7b0;
  --border-color: #e8ddee;
  --focus-ring-color: var(--accent-color-light);
  --link-color: var(--accent-color-darker);
  --link-hover-color: #5a9cb0;
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 20%, transparent);
  --highlight-border-color: var(--accent-color-light);
  --loading-spinner-color: var(--accent-color);
  --achievement-color: #f7dc6f; /* Pastel yellow */

  --sf-dashboard-item-bg: color-mix(in srgb, var(--accent-color) 10%, transparent);
  --sf-slider-track-bg: #e8ddee;
  --notification-achievement-bg: var(--achievement-color);
  --notification-text-dark: #333; /* Dark text for pastel achievement bg */

   --card-bg-color-rgb: 255, 255, 255;
}

/* --- Velvet Theme --- */
html[data-theme="velvet"] { /* Use html attribute for theme */
  --bg-color: #1a122a;
  --card-bg-color: #2c1f3e;
  --text-color: #e8ddee;
  --text-color-light: #e8ddee; /* Light text for accent bg */
  --accent-color: #dcc1ff; /* Light purple */
  --accent-color-darker: #b899e0;
  --accent-color-light: #c8a8f0;
  --accent-color-lighter: #4a3a5f; /* Darker highlight */
  --muted-text-color: #a08cb0;
  --border-color: #4a3a5f;
  --focus-ring-color: var(--accent-color-light);
  --link-color: var(--accent-color);
  --link-hover-color: var(--accent-color-light);
  --highlight-bg-color: color-mix(in srgb, var(--accent-color) 15%, transparent);
  --highlight-border-color: var(--accent-color);
  --loading-spinner-color: var(--accent-color-light);
  --achievement-color: #f4d03f; /* Richer gold for velvet */

  --chart-grid-color: rgba(232, 221, 238, 0.15);
  --chart-label-color: var(--muted-text-color);
  --chart-line-color: var(--accent-color);
  --chart-point-color: var(--accent-color-darker);
  --chart-tooltip-bg: rgba(255, 255, 255, 0.8);
  --chart-tooltip-text: #000;

  --sf-modal-bg: #2c1f3e;
  --sf-progress-color: var(--muted-text-color);
  --sf-dashboard-item-bg: rgba(220, 193, 255, 0.1);
  --sf-slider-track-bg: #4a3a5f;
  --sf-slider-footnote-color: var(--muted-text-color);
  --sf-popup-bg: #2c1f3e;
  --sf-score-delta-negative-color: var(--muted-text-color);

  --notification-info-bg: #90caf9;
  --notification-success-bg: #81c784;
  --notification-error-bg: #e57373;
  --notification-warning-bg: #ffb74d;
  --notification-achievement-bg: var(--achievement-color);
  --notification-text-light: #000000; /* Dark text for achievement bg */
  --notification-text-dark: #ffffff; /* Light text for others */

   --card-bg-color-rgb: 44, 31, 62;
}

/* --- General Styles & Resets --- */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: var(--font-family-base);
  background-color: var(--bg-color);
  color: var(--text-color);
  line-height: var(--line-height-base);
  font-size: var(--font-size-base);
  transition: background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  min-height: 100vh; /* Ensure body takes full height */
  display: flex;
  flex-direction: column; /* Stack header, main, footer vertically */
}
h1, h2, h3, h4 { margin-bottom: 0.75em; color: var(--accent-color); line-height: 1.3; transition: color var(--transition-duration) var(--transition-timing); }
h1 { font-size: clamp(1.8em, 4vw, 2.4em); text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
h2 { font-size: clamp(1.5em, 3.5vw, 2em); }
h3 { font-size: clamp(1.2em, 3vw, 1.6em); margin-top: 1.5em; }
h4 { font-size: clamp(1.05em, 2.5vw, 1.25em); color: var(--text-color); margin-bottom: 0.5em; }
p { margin-bottom: 1em; }
ul, ol { list-style: none; margin-bottom: 1em; }
dl { margin-bottom: 1em; }
dt { font-weight: bold; color: var(--accent-color); margin-top: 1em; font-size: 1.05em; }
dd { margin-left: 1.5em; margin-bottom: 0.5em; }
dd ul, dd ol { list-style: disc; padding-left: 1.5em; margin-top: 0.3em; }
dd ol { list-style: decimal;}
a, .link-button { color: var(--link-color); text-decoration: none; transition: color var(--transition-duration) var(--transition-timing); cursor: pointer; }
a:hover, .link-button:hover { color: var(--link-hover-color); text-decoration: underline; }
.link-button { background: none; border: none; padding: 0; font: inherit; text-decoration: underline; }
*:focus-visible { outline: var(--border-width-thick) solid var(--focus-ring-color); outline-offset: 2px; box-shadow: 0 0 0 4px color-mix(in srgb, var(--focus-ring-color) calc(var(--focus-ring-alpha) * 100%), transparent); border-radius: 2px; }
*:focus:not(:focus-visible) { outline: none; }
hr { border: none; border-top: var(--border-width) dashed var(--border-color); margin: 1.5em 0; }
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }


/* --- Layout & Structure --- */
main.container { /* Target main element specifically */
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 340px), 1fr));
    gap: 1.5em;
    padding: 1.5em;
    max-width: 1500px;
    margin: 1.5em auto;
    flex-grow: 1; /* Allow main content to grow */
}
.card { background: var(--card-bg-color); padding: 1.5em; border-radius: var(--border-radius-medium); box-shadow: var(--card-shadow); border: var(--border-width) solid var(--border-color); transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), box-shadow var(--transition-duration) var(--transition-timing); }


/* --- Header --- */
.app-header { padding: 0.8em 1.5em; background: var(--accent-color); color: var(--text-color-light); display: flex; flex-wrap: wrap; justify-content: space-between; align-items: stretch; border-bottom: 3px solid color-mix(in srgb, var(--accent-color) 80%, black); box-shadow: 0 2px 8px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 500; transition: background-color var(--transition-duration) var(--transition-timing); min-height: 55px; flex-shrink: 0; /* Prevent header from shrinking */ }
.app-header h1 { margin: 0 1em 0 0; font-size: clamp(1.4em, 3vw, 1.8em); color: var(--text-color-light); text-shadow: 1px 1px 2px rgba(0,0,0,0.2); flex-shrink: 0; margin-bottom: 0; display: flex; align-items: center; }
.header-nav { display: flex; flex-wrap: wrap; gap: 0.6em; align-items: stretch; margin-left: auto; }
.header-btn { background: none; border: var(--border-width-thick) solid var(--text-color-light); color: var(--text-color-light); padding: 0.4em 0.8em; border-radius: var(--border-radius-small); cursor: pointer; font-size: clamp(0.75em, 1.5vw, 0.9em); font-weight: bold; transition: background-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease; white-space: nowrap; display: inline-flex; align-items: center; justify-content: center; text-align: center; }
.header-btn:hover, .header-btn:focus-visible { background: rgba(255, 255, 255, 0.2); transform: translateY(-1px); box-shadow: var(--button-shadow); }
.theme-btn { font-size: 1.2em; padding: 0.2em 0.5em; }

/* --- Form Section --- */
.form-section h2 { text-align: center; margin-bottom: 1.5em; }
.field-group { margin-bottom: 1.3em; }
.field-group label { display: block; font-weight: 600; margin-bottom: 0.5em; color: var(--accent-color); font-size: 0.95em; }
.field-group input[type="text"], .field-group select, .field-group textarea { width: 100%; padding: 0.8em 1em; font-size: 1em; border: var(--border-width) solid var(--border-color); border-radius: var(--border-radius-small); background: var(--bg-color); color: var(--text-color); transition: border-color var(--transition-duration) var(--transition-timing), background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing), box-shadow var(--transition-duration) var(--transition-timing); box-shadow: var(--input-shadow-inset); accent-color: var(--accent-color); }
.field-group input[type="text"]:focus, .field-group select:focus, .field-group textarea:focus { border-color: var(--accent-color); background-color: var(--card-bg-color); }
.field-group select { appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%238a5a6d' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.414l-4.707-4.707a1 1 0 011.414-1.414L8 8.586l3.293-3.293a1 1 0 111.414 1.414L8 11.414z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.8em center; background-size: 1em; padding-right: 2.5em; }
html[data-theme="dark"] .field-group select, html[data-theme="velvet"] .field-group select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23c49db1' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.414l-4.707-4.707a1 1 0 011.414-1.414L8 8.586l3.293-3.293a1 1 0 111.414 1.414L8 11.414z'/%3E%3C/svg%3E"); }
html[data-theme="pastel"] .field-group select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23b0a7b0' viewBox='0 0 16 16'%3E%3Cpath d='M8 11.414l-4.707-4.707a1 1 0 011.414-1.414L8 8.586l3.293-3.293a1 1 0 111.414 1.414L8 11.414z'/%3E%3C/svg%3E"); }
.field-group textarea { resize: vertical; min-height: 80px; }
.style-helpers { display: flex; align-items: center; gap: 0.8em; margin-top: 0.5em; font-size: 0.85em; flex-wrap: wrap; }
.explore-style-link { font-style: italic; color: var(--muted-text-color); }
.explore-style-link:hover { color: var(--link-hover-color); }

/* Avatar Picker */
.avatar-picker-fieldset { border: none; padding: 0; margin: 0; margin-top: 0.5em; }
.avatar-picker-fieldset legend { display: block; font-weight: 600; margin-bottom: 0.5em; color: var(--accent-color); font-size: 0.95em; float: left; /* Align legend left */ margin-right: 10px; line-height: 1.8em; /* Match avatar size roughly */ }
.avatar-picker { display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }
#avatar-display { font-size: 1.8em; margin-right: 10px; display: inline-block; width: 1.5em; text-align: center; vertical-align: middle; }
.avatar-btn { background: none; border: 2px solid transparent; border-radius: 8px; font-size: 1.5em; padding: 2px; cursor: pointer; transition: border-color 0.2s ease, transform 0.1s ease; line-height: 1; vertical-align: middle; }
.avatar-btn:hover { transform: scale(1.1); }
.avatar-btn.selected { border-color: var(--accent-color); }
.avatar-btn:focus-visible { border-color: var(--focus-ring-color); }

/* Traits Area */
#traits-message { margin-top: 1.5em; padding: 1em; background-color: var(--bg-color); border: var(--border-width) dashed var(--border-color); border-radius: var(--border-radius-small); text-align: center; transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing); }
#traits-container { margin-top: 1.5em; border-top: var(--border-width) dashed var(--border-color); padding-top: 1.5em; position: relative; transition: border-color var(--transition-duration) var(--transition-timing); }
#traits-container:empty, #traits-container > p.muted-text:only-child { border-top: none; padding-top: 0; margin-top: 0; } /* Hide border if empty or only placeholder */

/* Individual Trait Styling */
.trait { margin-bottom: 1.5em; padding-bottom: 1.5em; border-bottom: 1px solid var(--border-color); }
.trait:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.trait label.trait-label { display: flex; align-items: center; justify-content: space-between; font-weight: 600; margin-bottom: 0.6em; color: var(--text-color); font-size: 1.05em; }
.trait-label span { /* Allow label text to wrap */ flex-grow: 1; padding-right: 8px; }
.trait-info-btn { margin-left: 8px; flex-shrink: 0; }
.trait .slider-container { display: flex; align-items: center; gap: 10px; }
.trait input[type="range"].trait-slider { flex-grow: 1; margin: 0; vertical-align: middle; accent-color: var(--accent-color); cursor: pointer; }
.trait input[type="range"].trait-slider:active { cursor: grabbing; }
.trait-value { width: 30px; text-align: right; font-weight: bold; color: var(--accent-color); vertical-align: middle; flex-shrink: 0; }
.trait-desc { font-size: 0.9em; margin-top: 0.5em; min-height: 1.2em; /* Prevent layout shift */ color: var(--muted-text-color); }


/* Trait Info & Context Help Popups */
.trait-info-popup, .context-help-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 450px; z-index: 1010; padding: 1.8em; border: var(--border-width-thick) solid var(--accent-color); background-color: var(--card-bg-color); box-shadow: 0 8px 25px rgba(0,0,0,0.2); border-radius: var(--border-radius-medium); transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), opacity 0.2s ease; opacity: 1; }
.context-help-popup { max-width: 400px; padding: 1.5em; }
.trait-info-popup h4, .context-help-popup h4 { margin-top: 0; text-align: center; color: var(--accent-color); }
#trait-info-body p, #context-help-body p { margin-bottom: 0.8em; font-size: 0.95em; line-height: 1.5; }
#trait-info-body strong, #context-help-body strong { color: var(--accent-color-darker); } /* Style strong tags if needed */
.popup-close { position: absolute; top: 8px; right: 10px; background: none; border: none; font-size: 1.8em; line-height: 1; color: var(--muted-text-color); cursor: pointer; padding: 0.1em 0.3em; transition: color 0.2s ease, transform 0.2s ease; }
.popup-close:hover { color: var(--accent-color); transform: scale(1.1) rotate(90deg); }

/* Form Actions (Save/Clear Buttons) */
.form-actions { display: flex; flex-wrap: wrap; gap: 1em; margin-top: 1.8em; justify-content: center; }
.save-btn, .clear-btn { border: none; padding: 0.8em 1.8em; font-size: 1.1em; border-radius: 50px; cursor: pointer; font-weight: bold; transition: transform 0.2s ease, background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.5em; }
.save-btn { background: var(--accent-color); color: var(--text-color-light); }
.save-btn:hover:not(:disabled) { background: var(--accent-color-darker); transform: translateY(-2px); box-shadow: var(--button-shadow); }
.clear-btn { background: var(--muted-text-color); color: var(--card-bg-color); }
.clear-btn:hover:not(:disabled) { background: var(--text-color); transform: translateY(-2px); box-shadow: var(--button-shadow); }
.save-btn:disabled, .clear-btn:disabled { background: color-mix(in srgb, var(--muted-text-color) 70%, transparent); color: color-mix(in srgb, var(--text-color-light) 70%, transparent); cursor: not-allowed; /* Changed cursor */ transform: none; box-shadow: none; opacity: 0.7; }
.save-btn.loading { cursor: wait; } /* Indicate loading state */

/* --- List Section --- */
.list-section h2 { text-align: center; }
#people-list { padding: 0; margin-top: 1em; }
#people-list li { display: flex; align-items: center; justify-content: space-between; background: var(--bg-color); padding: 0.8em 1.2em; margin-bottom: 0.8em; border-radius: var(--border-radius-small); border: var(--border-width) solid var(--border-color); transition: background-color var(--transition-duration) ease, box-shadow var(--transition-duration) ease; }
#people-list li:hover, #people-list li:focus-within { background: var(--highlight-bg-color); box-shadow: 0 2px 8px rgba(74, 44, 61, 0.1); border-color: var(--highlight-border-color); }
#people-list li:focus-within { outline: none; /* Outline handled by focused buttons */ }
.person-info { display: flex; align-items: center; gap: 1em; cursor: pointer; flex-grow: 1; padding: 0.2em; /* Clickable area padding */ border-radius: var(--border-radius-small); overflow: hidden; /* Prevent content overflow */ }
.person-avatar { font-size: 1.6em; line-height: 1; }
.person-name-details { display: flex; flex-direction: column; overflow: hidden; /* Prevent long names breaking layout */ }
.person-name { font-weight: bold; font-size: 1.1em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.person-details { font-size: 0.9em; color: var(--muted-text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.person-achievements-preview { margin-left: 0.5em; font-size: 0.8em; color: var(--achievement-color); }
.person-actions { display: flex; gap: 0.5em; flex-shrink: 0; /* Prevent shrinking */ margin-left: 1em; }


/* Small buttons (Edit/Delete in list, Goals etc) */
.small-btn { background: var(--accent-color); color: var(--text-color-light); border: none; padding: 0.4em 0.8em; border-radius: 15px; cursor: pointer; font-size: 0.85em; transition: background-color 0.2s ease, transform 0.1s ease; line-height: 1.2; display: inline-flex; align-items: center; justify-content: center; white-space: nowrap; }
.small-btn:hover:not(:disabled) { background: var(--accent-color-darker); transform: scale(1.05); }
.delete-btn { background: var(--danger-color); }
.delete-btn:hover:not(:disabled) { background: color-mix(in srgb, var(--danger-color) 80%, black); }
.context-help-btn { background: none; border: 1px solid var(--muted-text-color); color: var(--muted-text-color); border-radius: 50%; width: 22px; height: 22px; font-size: 0.9em; font-weight: bold; padding: 0; line-height: 1; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; cursor: help; }
.context-help-btn:hover { background: var(--bg-color); border-color: var(--accent-color); color: var(--accent-color); transform: scale(1.1); }
.accent-btn { background-color: var(--accent-color-darker); } /* For specific important buttons like Oracle */
.accent-btn:hover { background-color: var(--accent-color); }
.small-btn:disabled { background-color: var(--border-color); color: var(--muted-text-color); cursor: not-allowed; transform: none; }

/* --- Preview Section --- */
.preview-section { /* Optional: Adjust height or overflow */ min-height: 200px; }
.preview-section h2 { text-align: center; }
#live-preview { margin-top: 1em; }
.preview-title { text-align: center; font-size: 1.2em; margin-bottom: 1em; font-weight: bold; }
.preview-avatar-name { text-align: center; margin-bottom: 1em; }
.preview-avatar-name .person-avatar { font-size: 2em; display: block; margin: 0 auto 0.3em auto; }
.preview-role-style { text-align: center; margin-bottom: 1em; color: var(--muted-text-color); font-style: italic; }
.preview-breakdown { margin-top: 1em; padding: 1em; background-color: var(--bg-color); border: 1px dashed var(--border-color); border-radius: var(--border-radius-small);}
.preview-breakdown h4 { font-size: 1em; color: var(--accent-color); margin-bottom: 0.5em; border-bottom: 1px dashed var(--accent-color-light); padding-bottom: 0.3em;}
.preview-breakdown p { font-size: 0.95em; line-height: 1.5; margin-bottom: 1em; }
.preview-breakdown .strengths { margin-bottom: 1em; }
.preview-breakdown b, .preview-breakdown strong { color: var(--accent-color-darker); } /* Make bold stand out */

/* Daily Challenge in Preview/Insights */
#daily-challenge-area {
    margin-top: 1.5em;
    padding: 1em 1.2em;
    border: 1px solid var(--accent-color-light);
    border-left: 4px solid var(--accent-color);
    background-color: var(--highlight-bg-color);
    border-radius: var(--border-radius-small);
    text-align: center;
}
#daily-challenge-area h4 { /* Today's Focus Title */
    margin-top: 0;
    margin-bottom: 0.3em;
    color: var(--accent-color-darker);
    font-size: 1.1em;
}
#daily-challenge-area h5 { /* Challenge Title */
    margin-bottom: 0.5em;
    font-size: 1.05em;
    color: var(--text-color);
}
#daily-challenge-area p { /* Challenge Description */
    margin-bottom: 0.5em;
    font-size: 0.95em;
}
#daily-challenge-area .muted-text { /* Category */
    margin-top: 0.8em;
    margin-bottom: 0;
    font-size: 0.8em;
}


/* --- Modals (General) --- */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.65); backdrop-filter: blur(3px); display: flex; align-items: center; justify-content: center; padding: 1em; overflow-y: auto; }
.modal[aria-hidden="true"] { display: none; }
.modal[aria-hidden="false"] { display: flex; animation: modalFadeIn 0.3s ease forwards; } /* Add fade-in */
.modal-content { position: relative; background: var(--card-bg-color); padding: 2em; border-radius: var(--border-radius-medium); border: var(--border-width-thick) solid var(--accent-color); max-width: 95%; width: 700px; max-height: 90vh; /* Prevents modal exceeding viewport height */ overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.25); transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing); display: flex; flex-direction: column; }
.modal-content.wide-modal { width: 900px; }
.modal-close { position: absolute; top: 12px; right: 15px; background: none; border: none; font-size: 2em; line-height: 1; color: var(--muted-text-color); cursor: pointer; padding: 0.1em 0.3em; transition: color 0.2s ease, transform 0.2s ease; z-index: 10; }
.modal-close:hover { color: var(--accent-color); transform: scale(1.15) rotate(90deg); }
.modal h2 { margin-top: 0; text-align: center; color: var(--accent-color); padding-right: 30px; /* Space for close button */ }

@keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

/* --- Persona Detail Modal --- */
#detail-modal .modal-content { width: 800px; max-width: 95%; }
.modal-title { font-size: 1.8em; margin-bottom: 0.2em; text-align: center; }
.modal-subtitle { text-align: center; margin-top: 0.2em; margin-bottom: 1em; color: var(--muted-text-color); font-weight: bold; font-size: 1.05em; }
.modal-intro { font-style: italic; color: var(--accent-color-darker); text-align: center; margin: -0.5em auto 1.5em auto; font-size: 1.1em; max-width: 80%;}

/* Detail Modal Tabs */
.modal-tabs { display: flex; flex-wrap: wrap; border-bottom: var(--border-width-thick) solid var(--border-color); margin: 0 -2em 1.5em -2em; padding: 0 1.5em; flex-shrink: 0; /* Prevent tabs shrinking */ }
.tab-link { background: none; border: none; border-bottom: 3px solid transparent; padding: 0.8em 1.2em; cursor: pointer; font-size: 0.95em; font-weight: 600; color: var(--muted-text-color); transition: color 0.2s ease, border-color 0.2s ease; margin-bottom: -2px; /* Overlap border */ white-space: nowrap; }
.tab-link:hover { color: var(--accent-color-darker); }
.tab-link.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }
.tab-link:focus-visible { outline-offset: -2px; background-color: var(--highlight-bg-color); }

/* Detail Modal Tab Content */
#modal-body { padding: 0.5em; flex-grow: 1; /* Allow body to take remaining space */ overflow-y: auto; /* Allow body content to scroll if needed */ }
.tab-content { display: none; padding: 0.5em 0.2em; animation: modalFadeIn 0.4s ease forwards; }
.tab-content.active { display: block; }
.tab-content section { margin-top: 0; margin-bottom: 1.8em; padding: 1.5em; border: var(--border-width) solid var(--border-color); border-radius: var(--border-radius-small); background-color: color-mix(in srgb, var(--card-bg-color) 95%, var(--bg-color)); box-shadow: 0 2px 5px rgba(74, 44, 61, 0.05); transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing); }
.tab-content section:last-child { margin-bottom: 0.5em; }
.tab-content section h3 { margin-top: 0; margin-bottom: 1em; padding-bottom: 0.6em; border-bottom: var(--border-width) dashed var(--accent-color); display: flex; align-items: center; justify-content: space-between; gap: 0.6em; font-size: 1.3em; transition: border-color var(--transition-duration) var(--transition-timing); }
.loading-text { text-align: center; padding: 2em; color: var(--muted-text-color); font-style: italic; }
.error-text { text-align: center; padding: 2em; color: var(--danger-color); font-weight: bold; }

/* Goals Section (Detail Modal) */
.goals-section ul { list-style: none; padding: 0; margin-bottom: 1.5em; }
.goals-section li { display: flex; justify-content: space-between; align-items: center; padding: 0.6em 0; border-bottom: 1px dashed var(--border-color); transition: opacity 0.3s ease, text-decoration 0.3s ease; }
.goals-section li:last-child { border-bottom: none; }
/* Goal Strikethrough Fix */
.goals-section li.done { opacity: 0.6; }
.goals-section li.done > .goal-text { text-decoration: line-through; font-style: italic; color: var(--muted-text-color); }
.goal-text { flex-grow: 1; padding-right: 1em; word-break: break-word; /* Prevent long goals overflowing */ }
.goal-actions { display: flex; gap: 0.5em; flex-shrink: 0; }
.add-goal-form { display: flex; gap: 0.8em; margin-top: 1em; align-items: center; }
.add-goal-form input[type="text"] { flex-grow: 1; margin: 0; }
.add-goal-form button { flex-shrink: 0; margin: 0; }

/* Goal Completion Animation */
@keyframes goal-complete-pop {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.8; background-color: var(--accent-color-lighter); }
  100% { transform: scale(1); opacity: 1; }
}
.goal-completed-animation { /* Add this class to the <li> when completed */
   animation: goal-complete-pop 0.6s ease-out;
}


/* Style Breakdown (Detail Modal) */
.style-breakdown { padding: 0.5em; }
.style-breakdown .strengths, .style-breakdown .improvements { margin-bottom: 1em; }
.style-breakdown h4 { margin-top: 0; font-size: 1.1em; }
.style-breakdown p { margin-bottom: 0.5em; } /* Reduce space between breakdown paragraphs */

/* Trait Details Grid (Detail Modal) */
.trait-details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.2em; }
.trait-detail-item { padding: 1em; background-color: var(--bg-color); border-radius: var(--border-radius-small); border: 1px solid var(--border-color); }
.trait-detail-item h4 { margin-top: 0; margin-bottom: 0.6em; font-size: 1.1em; display: flex; justify-content: space-between; align-items: center; }
.trait-detail-item h4 a { color: inherit; text-decoration: none; border-bottom: 1px dotted; transition: color 0.2s; }
.trait-detail-item h4 a:hover { color: var(--link-hover-color); border-bottom-style: solid; }
.trait-detail-item .trait-score-badge { background: var(--accent-color-lighter); color: var(--accent-color-darker); padding: 0.2em 0.5em; border-radius: 10px; font-size: 0.9em; font-weight: bold; white-space: nowrap; }
html[data-theme="dark"] .trait-detail-item .trait-score-badge, html[data-theme="velvet"] .trait-detail-item .trait-score-badge { background: var(--accent-color-darker); color: var(--text-color-light); }
.trait-detail-item p { font-size: 0.9em; line-height: 1.5; margin-bottom: 0; }
.trait-detail-item p:last-child { margin-bottom: 0; }
.trait-detail-item strong { color: var(--accent-color-darker); }
.trait-detail-item em { color: var(--muted-text-color); font-style: normal; }

/* History Section (Detail Modal) */
#snapshot-btn { display: block; margin: 1.2em auto 0 auto; }
.snapshot-list { margin-top: 1.5em; padding-left: 0; list-style: none; }
.snapshot-list li { margin-bottom: 0.8em; padding-bottom: 0.8em; border-bottom: 1px dotted var(--border-color); }
.snapshot-list li:last-child { border-bottom: none; }
.snapshot-item { /* Wrapper for button and details */ }
.snapshot-list .snapshot-toggle { margin-left: 0.5em; }
.snapshot-details { background-color: var(--bg-color); padding: 0.8em; margin-top: 0.5em; border-radius: var(--border-radius-small); border: 1px solid var(--border-color); }
.snapshot-details ul { list-style: none; padding: 0; margin: 0; font-size: 0.9em; }
.snapshot-details li { border: none; padding: 0.2em 0; margin: 0; }
.history-chart-container{ max-width: 100%; margin: 1.8em auto 1.2em auto; position: relative; height: 320px; }
#history-chart { display: block; width: 100% !important; height: 100% !important; }
.history-chart-container.chart-loading::after { content: 'Loading Chart...'; position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background: rgba(var(--card-bg-color-rgb, 255, 255, 255), 0.8); color: var(--muted-text-color); font-style: italic; z-index: 5; }
html[data-theme="dark"] .history-chart-container.chart-loading::after, html[data-theme="velvet"] .history-chart-container.chart-loading::after { background: rgba(var(--card-bg-color-rgb, 44, 31, 62), 0.8); }

/* Achievements Panel Polish (Inside Detail Modal 'Insights' Tab) */
.achievements-section { background: none; border: none; box-shadow: none; padding: 0; }
.achievements-section ul { display: flex; flex-wrap: wrap; gap: 0.8em; margin-top: 0.5em; padding-left: 0; justify-content: flex-start; /* Align left */ }
.achievements-section li { background: var(--bg-color); border: var(--border-width) solid var(--border-color); padding: 0.5em 0.8em; border-radius: var(--border-radius-medium); text-align: center; display: flex; flex-direction: column; align-items: center; gap: 0.2em; min-width: 90px; transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), transform 0.1s ease; cursor: default; /* Not interactive here */ }
.achievements-section li:hover { transform: translateY(-1px); border-color: var(--accent-color-light); }
.achievements-section .achievement-icon { font-size: 1.4em; line-height: 1; }
.achievements-section .achievement-name { font-weight: bold; font-size: 0.75em; line-height: 1.2; }
.achievements-section li.locked { opacity: 0.6; }
.achievements-section li.locked .achievement-icon { filter: grayscale(80%); }


/* Oracle Panel Enhancement (Inside Detail Modal 'Insights' Tab) */
.oracle-tab-content { /* Style the section containing the oracle */
   border-radius: var(--border-radius-small);
   padding: 1em 0 0 0; /* Adjust padding */
   background: none; /* Remove section background if desired */
   border: none;
   box-shadow: none;
}
#oracle-reading-output {
    font-family: 'Georgia', serif; /* Suggest a slightly more evocative font */
    line-height: 1.7;
    text-align: center;
    border: 1px dashed var(--accent-color-light);
    padding: 1.2em; /* Slightly reduce padding */
    border-radius: var(--border-radius-small);
    background-color: color-mix(in srgb, var(--accent-color) 5%, transparent);
    margin-bottom: 1em;
    min-height: 100px; /* Give it some base height */
}
#oracle-reading-output p:first-child { /* Opening line */
    font-style: italic;
    color: var(--muted-text-color);
    margin-bottom: 0.8em;
}
#oracle-reading-output p strong { /* "Focus:" label and text */
    color: var(--accent-color-darker);
    font-weight: bold;
    display: block; /* Put Focus on its own line */
    margin-bottom: 0.5em;
    font-family: var(--font-family-base); /* Use base font for Focus text */
}
#oracle-reading-output p em { /* Encouragement */
    font-style: italic;
    font-size: 1.05em;
    margin: 1em 0;
    display: block; /* Ensure it takes its own line */
}
#oracle-reading-output p:last-child { /* Closing line */
     font-style: italic;
     color: var(--muted-text-color);
     margin-top: 0.8em;
}

/* Reflections Section (Detail Modal) */
.reflections-section .modal-actions { margin-bottom: 1.2em; text-align: center; display: flex; justify-content: center; align-items: center; gap: 1em; flex-wrap: wrap; }
.reflections-textarea { display: block; width: 100%; min-height: 150px; margin-bottom: 1.2em; line-height: 1.7; /* Inherit font/color/bg from form inputs */ padding: 0.8em 1em; font-size: 1em; border: var(--border-width) solid var(--border-color); border-radius: var(--border-radius-small); background: var(--bg-color); color: var(--text-color); transition: border-color 0.2s, background-color 0.2s; }
.reflections-textarea:focus { border-color: var(--accent-color); background-color: var(--card-bg-color); }
#save-reflections-btn { /* Uses small-btn styling */ }
.journal-prompt { padding: 0.8em; background: var(--highlight-bg-color); border-radius: var(--border-radius-small); margin-bottom: 1em; text-align: center; font-style: italic; font-size: 0.95em; }

/* --- Achievements Modal (Standalone) --- */
#achievements-modal .modal-content { width: 900px; max-width: 95%; }
#achievements-body h2 { margin-bottom: 0.5em; }
#achievements-body > p { text-align: center; margin-bottom: 1.5em; font-size: 0.95em; color: var(--muted-text-color); }
#achievements-body .modal-actions { margin-top: 1.5em; text-align: center; } /* Optional actions like filter */

/* Achievements Panel Polish (Standalone Modal Version) */
.all-achievements-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.2em; padding: 0; margin-top: 1em; }
.all-achievements-list li { background: var(--bg-color); border: var(--border-width) solid var(--border-color); border-left: 6px solid var(--muted-text-color); padding: 1.2em; border-radius: var(--border-radius-small); display: flex; align-items: center; gap: 1em; transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), transform 0.2s ease; }
.all-achievements-list li:hover { transform: translateY(-2px); box-shadow: var(--card-shadow); }
.all-achievements-list li.locked { opacity: 0.65; border-left-color: color-mix(in srgb, var(--muted-text-color) 50%, transparent); }
.all-achievements-list li.unlocked { border-left-color: var(--achievement-color); background-color: color-mix(in srgb, var(--achievement-color) 10%, var(--bg-color)); }
html[data-theme="dark"] .all-achievements-list li.unlocked, html[data-theme="velvet"] .all-achievements-list li.unlocked { border-left-color: var(--achievement-color); background-color: color-mix(in srgb, var(--achievement-color) 12%, var(--bg-color)); }
html[data-theme="pastel"] .all-achievements-list li.unlocked { background-color: color-mix(in srgb, var(--achievement-color) 15%, var(--bg-color)); }
.all-achievements-list .achievement-icon { font-size: 2.2em; flex-shrink: 0; line-height: 1; }
.all-achievements-list .achievement-details { display: flex; flex-direction: column; }
.all-achievements-list .achievement-name { font-weight: bold; font-size: 1.05em; color: var(--accent-color-darker); margin-bottom: 0.2em; }
.all-achievements-list li.locked .achievement-name { color: var(--text-color); }
.all-achievements-list .achievement-desc { font-size: 0.9em; color: var(--text-color); line-height: 1.5; }
.all-achievements-list li.locked .achievement-desc { color: var(--muted-text-color); font-style: italic; }


/* --- Other Auxiliary Modals --- */
/* Resources Modal Specifics */
#resources-modal dl dt { margin-top: 1.2em; }
#resources-modal dl dd { margin-left: 1em; }
#resources-modal .disclaimer { font-size: 0.85em; font-style: italic; color: var(--muted-text-color); margin-top: 1.5em; text-align: center; }

/* Glossary Modal Specifics */
#glossary-body dl dt { margin-top: 1.2em; scroll-margin-top: 70px; /* Offset for sticky header */ }
#glossary-body dl dd { margin-left: 1em; border-left: 3px solid var(--border-color); padding-left: 1em; transition: border-color var(--transition-duration) var(--transition-timing); }
#glossary-body .related-terms { font-size: 0.9em; color: var(--muted-text-color); margin-top: 0.5em; }
#glossary-body .related-terms a { color: var(--muted-text-color); border-bottom: 1px dotted; }
#glossary-body .related-terms a:hover { color: var(--link-hover-color); border-bottom-style: solid; }
.glossary-search { display: flex; gap: 0.5em; margin-bottom: 1.5em; }
.glossary-search input { flex-grow: 1; padding: 0.6em 0.8em; }
.glossary-search button { padding: 0.6em 0.8em; }

/* Style Discovery Modal Specifics */
.style-discovery-controls { margin-bottom: 1.5em; display: flex; flex-wrap: wrap; gap: 1em; justify-content: center; align-items: center; }
.style-discovery-controls label { margin-right: 0.5em; }
.style-discovery-controls select { min-width: 150px; }
.style-discovery-search input { min-width: 200px; padding: 0.6em 0.8em; }
#style-discovery-body { max-height: 65vh; overflow-y: auto; padding-right: 0.8em; margin-top: 1em;}
.style-discovery-item { margin-bottom: 1em; padding: 1em; border: 1px solid var(--border-color); border-radius: var(--border-radius-small); background-color: var(--bg-color); transition: background-color 0.2s, border-color 0.2s; }
.style-discovery-item:hover { background-color: var(--highlight-bg-color); border-color: var(--highlight-border-color); }
.style-discovery-item h4 { margin-top: 0; margin-bottom: 0.4em; font-size: 1.2em; }
.style-discovery-item h4 small { font-size: 0.8em; color: var(--muted-text-color); font-style: italic; }
.style-discovery-item p { margin-bottom: 0.6em; font-size: 0.95em; }
/* Hide trait list by default, can be added back if needed */
/* .style-discovery-item .traits-list { font-size: 0.85em; color: var(--muted-text-color); margin-top: 0.5em; } */
.style-discovery-item.hidden { display: none; } /* For search filtering */


/* Themes Modal Specifics */
.theme-options { display: flex; flex-wrap: wrap; gap: 1em; justify-content: center; }
.theme-option-btn { padding: 1em 1.5em; border: none; border-radius: var(--border-radius-small); font-size: 1em; font-weight: bold; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; text-align: center; min-width: 100px; }
.theme-option-btn:hover { transform: translateY(-2px); box-shadow: var(--button-shadow); }
.theme-option-btn[data-theme="light"] { background-color: #fff0f5; color: #4a2c3d; border: 1px solid #ff69b4; }
.theme-option-btn[data-theme="dark"] { background-color: #3c2f3c; color: #f4d4e4; border: 1px solid #ff85cb; }
.theme-option-btn[data-theme="pastel"] { background-color: #fdf6f9; color: #6d5a6d; border: 1px solid #a0d8ef; }
.theme-option-btn[data-theme="velvet"] { background-color: #2c1f3e; color: #e8ddee; border: 1px solid #dcc1ff; }

/* --- Highlighting --- */
.highlighted-term { background-color: var(--highlight-bg-color); border: 1px dashed var(--highlight-border-color); padding: 0.2em 0.4em; margin: -0.2em -0.4em; border-radius: 4px; display: inline-block; scroll-margin-top: 80px; /* Increase scroll margin */ animation: briefHighlight 2.5s ease-out; }
.highlighted-style { background-color: var(--highlight-bg-color); border: 1px solid var(--highlight-border-color); box-shadow: 0 0 10px var(--highlight-bg-color); scroll-margin-top: 80px; /* Increase scroll margin */ border-radius: var(--border-radius-small); /* Apply radius */ animation: briefHighlight 2.5s ease-out; }
@keyframes briefHighlight { 0%, 100% { background-color: transparent; border-color: transparent; box-shadow: none; } 10%, 90% { background-color: var(--highlight-bg-color); border-color: var(--highlight-border-color); /* Use solid for style highlight */ box-shadow: 0 0 10px var(--highlight-bg-color); } }


/* --- Style Finder Specific Styles --- */
.sf-modal .sf-modal-content {
    background: var(--sf-modal-bg, var(--card-bg-color));
    padding: 1.5em; /* Reduced padding slightly */
    border-radius: var(--border-radius-medium);
    max-width: 95%;
    width: 600px; /* Adjusted width */
    max-height: 95vh; /* Allow slightly more height */
    box-shadow: var(--card-shadow);
    transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
    display: flex;
    flex-direction: column;
    text-align: center;
    border: 1px solid var(--border-color); /* Softer border */
}

.sf-modal-content h3#sf-modal-title { /* Target title specifically */
    margin-top: 0;
    margin-bottom: 0.8em; /* Reduced margin */
    color: var(--accent-color);
    font-size: 1.6em; /* Slightly smaller title */
    font-weight: 600;
}

/* Progress Area */
.sf-progress-area { /* New wrapper for tracker and bar */
    margin-bottom: 1.5em;
    padding-bottom: 1em;
    border-bottom: 1px dashed var(--border-color);
}
#sf-progress-tracker {
    font-size: 0.85em; /* Smaller tracker text */
    color: var(--sf-progress-color, var(--muted-text-color));
    margin-bottom: 0.5em; /* Space between text and bar */
    font-weight: 500;
}
#sf-progress-bar-container {
    width: 100%; /* Full width */
    max-width: 350px;
    height: 10px; /* Slightly thicker bar */
    background-color: var(--border-color);
    border-radius: 5px; /* Match bar radius */
    margin: 0 auto;
    overflow: hidden;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
}
#sf-progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--accent-color-light), var(--accent-color)); /* Gradient bar */
    border-radius: 5px;
    transition: width 0.4s ease-out;
    box-shadow: inset 0 -1px 1px rgba(0,0,0,0.15);
}

/* Step Content Area */
#sf-step-content {
    padding: 0; /* Remove padding, handled by inner */
    position: relative;
    flex-grow: 1; /* Allow content to take available space */
    display: flex; /* Use flex for centering inner */
    flex-direction: column;
    justify-content: center; /* Center content vertically */
    min-height: 200px; /* Ensure minimum height */
    overflow: hidden; /* Prevent internal overflow issues */
}
#sf-step-content {
    padding: 0; /* Remove padding, handled by inner */
    position: relative;
    flex-grow: 1; /* Allow content to take available space */
    display: flex; /* Use flex for centering inner */
    flex-direction: column;
    justify-content: center; /* Center content vertically */
    min-height: 200px; /* Ensure minimum height */
    overflow: hidden; /* Prevent internal overflow issues */
}

/* Step Transition */
.sf-step-transition {
    opacity: 0;
    transform: translateY(15px);
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
}
#sf-step-content:not(.sf-step-transition) { /* Apply final state when class removed */
    opacity: 1;
    transform: translateY(0);
}

.sf-step-inner {
    padding: 1em 0.5em; /* Padding for inner content */
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center; /* Center horizontally */
    flex-grow: 1;
    justify-content: space-between; /* Space out content and buttons */
}

.sf-trait-content { /* Wrapper for trait text and slider */
    width: 100%;
    max-width: 450px; /* Limit width of trait area */
    margin-bottom: 1.5em; /* Space before buttons */
}
#sf-step-content.loading::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(var(--card-bg-color-rgb, 255, 255, 255), 0.7); z-index: 10; display: flex; align-items: center; justify-content: center; }
html[data-theme="dark"] #sf-step-content.loading::after, html[data-theme="velvet"] #sf-step-content.loading::after { background: rgba(var(--card-bg-color-rgb, 44, 31, 62), 0.7); }
#sf-step-content h2 {
    color: var(--accent-color-darker); /* Darker accent for title */
    margin-bottom: 0.8em;
    font-size: 1.4em;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5em;
    font-weight: 600;
}
#sf-step-content p { /* General paragraph styling */
    margin-bottom: 1em;
    color: var(--text-color);
    max-width: 90%;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}
p.sf-trait-desc { /* Specific description styling */
    font-size: 1.05em; /* Slightly larger trait desc */
    margin-bottom: 1.5em;
    color: var(--muted-text-color);
}

.sf-button-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1em;
    justify-content: center;
    margin-top: 1.5em; /* Consistent margin */
    width: 100%;
    padding: 0 1em; /* Padding for spacing */
}
.sf-button-container.trait-buttons {
    justify-content: space-between; /* Space out prev/next */
    margin-top: 1em; /* Less margin after slider */
}
.sf-role-btn {
    border: none;
    padding: 0.8em 1.8em;
    font-size: 1.1em;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.2s ease, background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
    min-width: 180px;
    color: var(--text-color-light);
}
.sf-nav-btn {
    background: var(--border-color);
    color: var(--text-color);
    border: none;
    padding: 0.6em 1.2em;
    font-size: 1em;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
    transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
}
.sf-nav-btn:hover:not(:disabled) {
    background: var(--accent-color-light);
    transform: scale(1.05);
    box-shadow: var(--button-shadow);
}
.sf-nav-btn.next-btn {
    background: var(--accent-color);
    color: var(--text-color-light);
    font-weight: bold;
}
.sf-nav-btn.next-btn:hover:not(:disabled) {
    background: var(--accent-color-darker);
}
.sf-nav-btn.clear-btn {
    background: var(--muted-text-color);
    color: var(--bg-color); /* Lighter text on muted */
}
.sf-nav-btn.clear-btn:hover:not(:disabled) {
    background: var(--text-color);
}
.sf-nav-placeholder { /* Takes up space when Prev button isn't shown */
    width: 80px; /* Approximate width of prev button */
    display: inline-block;
}
.sf-action-btn { /* Base for Apply */
    border: none;
    padding: 0.8em 1.8em;
    font-size: 1.05em;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
    background: var(--success-color); /* Green for apply */
    color: #fff;
}
.sf-action-btn:hover:not(:disabled) {
    background: color-mix(in srgb, var(--success-color) 85%, black);
    transform: translateY(-2px);
    box-shadow: var(--button-shadow);
}
.sf-details-link { /* Link-style button for details */
    font-size: 0.9em;
    margin-top: 0.5em;
}

.sf-role-btn.sub-btn { background: var(--accent-color); }
.sf-role-btn.sub-btn:hover { background: var(--accent-color-darker); transform: translateY(-2px); box-shadow: var(--button-shadow); }
.sf-role-btn.dom-btn { background: var(--accent-color-darker); } /* Use darker accent for Dom */
.sf-role-btn.dom-btn:hover { background: var(--accent-color); transform: translateY(-2px); box-shadow: var(--button-shadow); }
/* Use base button styles */
#sf-step-content button { /* Base styles defined below */ padding: 0.7em 1.5em; }
#sf-step-content button[data-action="setRole"] { min-width: 150px; font-size: 1.05em; }
#sf-step-content button.clear-btn { background: var(--muted-text-color); color: var(--card-bg-color); }
#sf-step-content button.small-btn { background: var(--border-color); color: var(--text-color); font-size: 0.9em; padding: 0.5em 1em; }
#sf-step-content button.small-btn:hover:not(:disabled) { background: var(--accent-color-light); }
#sf-feedback {
    font-size: 0.9em;
    color: var(--accent-color);
    margin: 1em 0 0 0; /* Position below content */
    min-height: 1.2em;
    font-weight: bold;
    /* Ensure it's placed correctly if needed */
     order: 5; /* Place it after dashboard if both visible */
     padding: 0 1em;
}
#sf-feedback.feedback-error { color: var(--danger-color); }
#sf-feedback.feedback-warning { color: var(--warning-color); }

#sf-dashboard {
    margin-top: 1.5em; /* Ensure space below buttons */
    font-size: 0.9em;
    color: var(--text-color);
    padding: 1em;
    background: var(--bg-color);
    border-radius: var(--border-radius-small);
    border: 1px dashed var(--border-color);
    animation: sfFadeIn 0.5s ease;
    width: 100%;
    max-width: 500px; /* Limit dashboard width */
    margin-left: auto;
    margin-right: auto;
    max-height: 200px; /* Limit height */
    overflow-y: auto; /* Add scroll */
    flex-shrink: 0; /* Prevent shrinking */
}
#sf-dashboard .sf-dashboard-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: nowrap;
    gap: 8px; /* Reduced gap */
    background: var(--sf-dashboard-item-bg, rgba(255, 112, 150, 0.05));
    border-radius: 6px; /* Smaller radius */
    padding: 0.5em 0.8em; /* Adjust padding */
    margin: 0.4em 0;
    box-shadow: none; /* Remove shadow */
    border: 1px solid var(--border-color);
}
#sf-dashboard .sf-style-name {
    font-size: 0.95em; /* Adjust size */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-basis: 50%; /* Give name more space */
    text-align: left;
}
#sf-dashboard .sf-score-bar-container {
    width: 60px; /* Slightly narrower bar */
    height: 6px;
}
#sf-dashboard .sf-dashboard-score {
    font-size: 0.95em;
    min-width: 80px; /* Ensure space for delta */
    text-align: right;
}
.sf-result-step {
    justify-content: flex-start; /* Align content top */
}
.sf-result-intro {
    font-size: 1.1em;
    color: var(--muted-text-color);
    margin-bottom: 1.5em !important; /* Ensure space */
}
.sf-result-summary {
    width: 100%;
    max-width: 550px; /* Limit result area width */
    margin-bottom: 2em;
}
.sf-result-summary h3 { /* Top Suggestion Header */
    color: var(--accent-color);
    margin-bottom: 0.5em;
    font-size: 1.3em;
}
.sf-result-summary h4 { /* Other headers */
    color: var(--text-color);
    margin-top: 1.5em;
    margin-bottom: 0.5em;
    font-size: 1.1em;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0.3em;
}

.sf-result-card {
    background-color: var(--bg-color);
    padding: 1em 1.2em;
    border-radius: var(--border-radius-small);
    border: 1px solid var(--border-color);
    margin-bottom: 1em;
    text-align: left;
}
.sf-result-card h4 { /* Title within top suggestion card */
    margin-top: 0;
    margin-bottom: 0.5em;
    font-size: 1.25em;
    color: var(--accent-color-darker);
    border: none;
    padding: 0;
}
.sf-result-card p {
    margin-bottom: 0.5em;
    line-height: 1.5;
    font-size: 0.95em;
}
.sf-result-card p strong { color: var(--accent-color-darker); }
.sf-result-card p em { color: var(--muted-text-color); font-style: italic; }
.sf-result-card .match-desc { font-size: 0.9em; color: var(--muted-text-color); }

html[data-theme="dark"] #sf-dashboard, html[data-theme="velvet"] #sf-dashboard { color: var(--text-color); background: var(--bg-color); border-color: var(--border-color); }
.sf-dashboard-header { font-size: 1.2em; color: var(--accent-color); margin-bottom: 0.8em; text-align: center; font-weight: bold; }
/* Style Finder Summary Dashboard Layout Fix */
.sf-dashboard-item { display: flex; justify-content: space-between; align-items: center; flex-wrap: nowrap; gap: 10px; background: var(--sf-dashboard-item-bg, rgba(255, 112, 150, 0.05)); border-radius: var(--border-radius-small); padding: 0.6em 1em; margin: 0.4em 0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); transition: transform 0.2s ease; }
html[data-theme="dark"] .sf-dashboard-item, html[data-theme="velvet"] .sf-dashboard-item { background: var(--sf-dashboard-item-bg, rgba(248, 225, 233, 0.08)); }
.sf-style-name { font-size: 1em; text-align: left; flex-grow: 1; flex-shrink: 1; padding-right: 10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.sf-dashboard-score { font-weight: bold; display: flex; align-items: center; gap: 5px; white-space: nowrap; color: var(--text-color); flex-shrink: 0; }
html[data-theme="dark"] .sf-dashboard-score, html[data-theme="velvet"] .sf-dashboard-score { color: var(--text-color); }
/* Score bar in dashboard */
.sf-dashboard-item .sf-score-bar-container { width: 80px; background: var(--border-color); border-radius: 4px; overflow: hidden; height: 8px; flex-shrink: 0; }
.sf-dashboard-item .sf-score-bar { height: 100%; background: var(--accent-color); border-radius: 4px; transition: width 0.3s ease; }
/* Score change indicators */
.sf-move-up, .sf-move-down { color: var(--accent-color); font-size: 1.2em; opacity: 1; animation: sfFadeOut 1s ease forwards; }
.sf-score-delta { font-size: 0.8em; padding: 2px 6px; border-radius: 10px; background: var(--highlight-bg-color); }
.sf-score-delta.positive { color: var(--accent-color-darker); }
html[data-theme="dark"] .sf-score-delta.positive, html[data-theme="velvet"] .sf-score-delta.positive { color: var(--accent-color-light); }
.sf-score-delta.negative { color: var(--sf-score-delta-negative-color, var(--muted-text-color)); }
/* Style Finder Slider */
.sf-trait-slider {
    width: 100%;
    max-width: 380px;
    margin: 15px auto 5px auto; /* Adjust margins */
    display: block;
    -webkit-appearance: none;
    appearance: none;
    height: 10px; /* Match progress bar */
    background: var(--sf-slider-track-bg, var(--border-color));
    border-radius: 5px;
    outline: none;
    transition: background 0.3s;
    accent-color: var(--accent-color);
    cursor: pointer;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
}
.sf-trait-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 24px; /* Larger thumb */
    height: 24px;
    background: var(--accent-color);
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 3px solid var(--sf-modal-bg, var(--card-bg-color)); /* Border matches modal bg */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.sf-trait-slider::-moz-range-thumb {
    width: 20px; /* Adjusted for consistency */
    height: 20px;
    background: var(--accent-color);
    border-radius: 50%;
    cursor: pointer;
    border: 3px solid var(--sf-modal-bg, var(--card-bg-color));
    transition: all 0.2s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.sf-trait-slider:hover::-webkit-slider-thumb,
.sf-trait-slider:focus-visible::-webkit-slider-thumb {
    background: var(--accent-color-darker);
    transform: scale(1.1);
}
.sf-trait-slider:hover::-moz-range-thumb,
.sf-trait-slider:focus-visible::-moz-range-thumb {
    background: var(--accent-color-darker);
    transform: scale(1.1);
}
.sf-trait-slider::-webkit-slider-thumb:hover, .sf-trait-slider::-moz-range-thumb:hover { background: var(--accent-color-darker); transform: scale(1.1); }
.sf-trait-slider:active { cursor: grabbing; }

.sf-trait-slider:active::-webkit-slider-thumb { box-shadow: 0 2px 6px rgba(0,0,0,0.3); }
.sf-trait-slider:active::-moz-range-thumb { box-shadow: 0 2px 6px rgba(0,0,0,0.3); }
.sf-slider-description {
    font-size: 1.1em; /* Larger description */
    color: var(--accent-color-darker);
    margin-top: 10px;
    font-weight: 600; /* Bolder */
    text-align: center;
    padding: 8px 15px; /* More padding */
    background: var(--highlight-bg-color);
    border-radius: var(--border-radius-small);
    border: 1px dashed var(--accent-color-light);
    max-width: 380px;
    margin-left: auto;
    margin-right: auto;
    min-height: 2.5em;
}
.sf-slider-footnote {
    font-size: 0.8em; /* Smaller footnote */
    color: var(--sf-slider-footnote-color, var(--muted-text-color));
    margin-top: 8px;
    text-align: center;
}
.sf-info-icon {
    cursor: pointer;
    margin-left: 8px;
    color: var(--muted-text-color); /* Subtler info icon */
    font-size: 1em; /* Adjust size */
    vertical-align: middle;
    transition: transform 0.2s, color 0.2s;
    background: none;
    border: none;
    padding: 0;
    line-height: 1;
}
.sf-info-icon:hover {
    transform: scale(1.2);
    color: var(--accent-color);
}

.sf-info-icon.active { color: var(--accent-color-darker); transform: scale(1.1); } /* Show active state */
/* Style Finder Popups */
.sf-style-info-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--sf-popup-bg, var(--card-bg-color)); padding: 2em; border-radius: var(--border-radius-medium); max-width: 500px; width: 90%; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25); z-index: 1010; text-align: left; max-height: 80vh; overflow-y: auto; border: 2px solid var(--accent-color); }
html[data-theme="dark"] .sf-style-info-popup, html[data-theme="velvet"] .sf-style-info-popup { background: var(--sf-popup-bg, #3b233a); }
.sf-style-info-popup.wide-popup { max-width: 700px; }
.sf-style-info-popup h3 { color: var(--accent-color); margin-top: 0; margin-bottom: 1em; text-align: center; }
.sf-style-info-popup h4 { margin-top: 1.5em; margin-bottom: 0.5em; color: var(--accent-color-darker); border-bottom: 1px dashed var(--border-color); padding-bottom: 0.3em; }
.sf-style-info-popup p { margin-bottom: 1em; line-height: 1.6; }
.sf-style-info-popup ul { list-style: disc; padding-left: 2em; margin-bottom: 1em; }
.sf-style-info-popup li { margin-bottom: 0.5em; }
.sf-close-btn { position: absolute; top: 10px; right: 12px; background: none; border: none; font-size: 1.8em; line-height: 1; color: var(--muted-text-color); cursor: pointer; padding: 0.1em 0.3em; transition: color 0.2s ease, transform 0.2s ease; }
.sf-close-btn:hover { color: var(--accent-color); transform: scale(1.15) rotate(90deg); }
/* Style Finder Results Section */
.sf-result-section { margin: 20px 0; text-align: center; }
#summary-dashboard { /* Override general dashboard styles slightly */
    margin-top: 0.5em;
    padding: 0.8em;
    max-height: none; /* No height limit here */
    overflow-y: visible;
    border-style: solid;
}
#summary-dashboard .sf-dashboard-item.summary-item {
    background: none; /* Simpler background */
    border: none;
    padding: 0.3em 0.5em;
    gap: 10px;
}
#summary-dashboard .sf-style-name { flex-basis: 45%; font-size: 0.9em;}
#summary-dashboard .sf-score-bar-container { width: 80px; height: 8px; }
#summary-dashboard .sf-dashboard-score { font-size: 0.9em; min-width: 40px;}

.sf-result-heading { color: var(--accent-color); border-bottom: 2px solid var(--accent-color); padding-bottom: 5px; display: inline-block; margin-bottom: 1em; }
.sf-result-section p { margin-bottom: 1em; text-align: left; max-width: 90%; margin-left: auto; margin-right: auto; }
.sf-result-section p strong { color: var(--accent-color-darker); }
.sf-result-section h3 { margin-top: 1.8em; margin-bottom: 0.8em; color: var(--accent-color-darker); border-bottom: 1px dashed var(--border-color); padding-bottom: 0.4em; display: inline-block; }
.sf-result-section ul { text-align: left; margin: 10px auto; max-width: 90%; list-style: '✧ '; padding-left: 1.5em; }
.sf-result-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 1.5em; }


/* --- Animations & Effects --- */
@keyframes sfFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
@keyframes sfBounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
@keyframes sfSlideIn { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
@keyframes sfFadeOut { from { opacity: 1; } to { opacity: 0; } }
/* Feedback bounce animation */
.feedback-animation { animation: sfBounce 0.5s ease; }
/* Shake animation for validation */
@keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
.shake-animation { animation: shake 0.5s ease-in-out; }

/* Loading Spinner */
.spinner { display: inline-block; border: 3px solid color-mix(in srgb, var(--loading-spinner-color) 30%, transparent); border-radius: 50%; border-top-color: var(--loading-spinner-color); width: 1em; height: 1em; animation: spin 1s linear infinite; vertical-align: middle; margin-left: 0.5em; }
@keyframes spin { to { transform: rotate(360deg); } }
button.loading .spinner { border: 3px solid rgba(255,255,255,0.3); border-top-color: #fff; } /* Spinner for buttons with light text */
button.clear-btn.loading .spinner { border: 3px solid rgba(255, 255, 255, 0.4); border-top-color: #fff; } /* Specific for clear button */

/* Item Saved Highlight */
@keyframes briefHighlightItem { 0%, 100% { background-color: var(--bg-color); border-color: var(--border-color); } 30%, 70% { background-color: var(--highlight-bg-color); border-color: var(--highlight-border-color); } }
.item-just-saved { animation: briefHighlightItem 1.5s ease-out; }

/* Input Saved Highlight (using box-shadow to avoid focus conflict) */
@keyframes briefInputHighlight {
  0%, 100% { box-shadow: var(--input-shadow-inset); }
  30%, 70% { box-shadow: var(--input-shadow-inset), 0 0 0 3px color-mix(in srgb, var(--success-color) 50%, transparent); }
}
.input-just-saved { animation: briefInputHighlight 1.5s ease-out; }


/* --- Footer --- */
.app-footer { text-align: center; margin-top: auto; /* Push footer down */ padding: 1.5em; border-top: 1px solid var(--border-color); color: var(--muted-text-color); font-size: 0.9em; flex-shrink: 0; /* Prevent footer shrinking */ transition: border-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing); }
.app-footer small { display: block; margin-top: 0.5em; }

/* --- Utility Classes --- */
.muted-text { color: var(--muted-text-color); font-style: italic; }

/* --- Notification Styles --- */
#app-notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 8px; z-index: 2000; opacity: 0; transition: opacity 0.5s ease, top 0.5s ease, background-color 0.3s ease, color 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 0.95em; text-align: center; pointer-events: none; max-width: 80%; }
.notification-success { background-color: var(--notification-success-bg); color: var(--notification-text-light); }
.notification-error { background-color: var(--notification-error-bg); color: var(--notification-text-light); }
.notification-warning { background-color: var(--notification-warning-bg); color: var(--notification-text-dark); }
.notification-info { background-color: var(--notification-info-bg); color: var(--notification-text-light); }
.notification-achievement { background-color: var(--notification-achievement-bg); color: var(--notification-text-dark); font-weight: bold; border: 2px solid color-mix(in srgb, var(--notification-achievement-bg) 80%, black); }


/* --- Live Preview Synergy Hint --- */
.preview-synergy-hint {
    margin-top: 1.5em;
    padding: 0.8em;
    background-color: var(--highlight-bg-color);
    border: 1px dashed var(--highlight-border-color);
    border-radius: var(--border-radius-small);
    font-size: 0.9em;
    text-align: center;
}
.preview-synergy-hint strong {
    color: var(--accent-color-darker);
}


/* --- Responsiveness --- */
@media (max-width: 900px) {
    .modal-content.wide-modal { width: 90%; }
    #detail-modal .modal-content { width: 90%; }
    .sf-style-info-popup.wide-popup { max-width: 90%; }
    .all-achievements-list { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
}
@media (max-width: 768px) {
    body { font-size: 15px; } /* Slightly smaller base font */
    main.container { padding: 1em; gap: 1em; }
    .card { padding: 1.2em; }
    .app-header { padding: 0.8em 1em; }
    .app-header h1 { font-size: clamp(1.3em, 4vw, 1.6em); }
    .header-nav { gap: 0.4em; align-items: center; }
    .header-btn { height: auto; padding: 0.3em 0.6em; font-size: clamp(0.7em, 1.8vw, 0.8em); }
    .theme-btn { font-size: 1.1em;}
    .modal-content { padding: 1.5em; max-width: 95%; width: auto; }
    .form-actions { flex-direction: column; }
    .trait-details-grid { grid-template-columns: 1fr; }
    .sf-modal .sf-modal-content { max-width: 95%; padding: 20px; }
    #sf-step-content h2 { font-size: 1.25em; }
    .modal-tabs { margin-left: -1.5em; margin-right: -1.5em; padding: 0 1em; overflow-x: auto; justify-content: flex-start; } /* Enable horizontal scroll */
    .modal-tabs::-webkit-scrollbar { height: 4px; } /* Simple scrollbar for tabs */
    .modal-tabs::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 2px; }
    .tab-link { padding: 0.7em 0.9em; font-size: 0.9em; }
    .all-achievements-list { grid-template-columns: 1fr; }
}
@media (max-width: 480px) {
    body { font-size: 14px; } /* Further reduce base font */
    .app-header { flex-direction: column; align-items: flex-start; padding-bottom: 0.8em;}
    .app-header h1 { margin-bottom: 0.5em; width: 100%; text-align: center; }
    .header-nav { margin-left: 0; width: 100%; justify-content: center; gap: 0.5em; } /* Center buttons */
    .header-btn { padding: 0.5em 0.8em; flex-grow: 1; flex-basis: calc(33% - 1em); /* Try 3 buttons per row */ } /* Allow buttons to grow */
    main.container { grid-template-columns: 1fr; padding: 0.8em; gap: 0.8em; }
    .card { padding: 1em; }
    .modal-content { padding: 1.2em; }
    .form-actions { gap: 0.8em; }
    .save-btn, .clear-btn { font-size: 1em; padding: 0.7em 1.5em; }
    .sf-modal .sf-modal-content { padding: 15px; }
    .sf-modal-content h3 { font-size: 1.4em; }
    #sf-step-content h2 { font-size: 1.15em; flex-direction: column; gap: 0.2em; align-items: center;} /* Center h2 content */
    .sf-trait-slider { max-width: 95%; }
    .sf-slider-description { font-size: 0.9em; padding: 8px 10px; min-height: 2.5em; }
    .sf-slider-footnote { font-size: 0.8em; }
    .sf-style-info-popup { max-width: 95%; padding: 15px; }
    .sf-style-info-popup h3 { font-size: 1.2em; }
    .sf-result-section ul { max-width: 90%; }
    #sf-step-content button { padding: 0.7em 1.4em; font-size: 0.95em; }
    .sf-result-buttons { gap: 8px; flex-direction: column;} /* Stack on small */
    .tab-link { padding: 0.6em 0.8em; font-size: 0.85em; }
    .all-achievements-list li { flex-direction: column; text-align: center; gap: 0.5em; padding: 1em; }
    .all-achievements-list .achievement-icon { font-size: 2em; }
    .person-info { flex-direction: column; align-items: flex-start; text-align: left; gap: 0.2em; } /* Stack avatar/details */
    .person-actions { flex-direction: column; align-self: center; margin-left: 0; gap: 0.4em;} /* Stack actions */
}
@media (max-width: 650px) {
    .sf-modal .sf-modal-content {
        width: 95%;
        padding: 1em;
    }
    #sf-step-content h2 {
        font-size: 1.25em;
    }
    p.sf-trait-desc {
        font-size: 1em;
    }
    .sf-trait-slider {
        max-width: 90%;
    }
    .sf-button-container {
        gap: 0.8em;
    }
    .sf-nav-btn, .sf-role-btn, .sf-action-btn {
        font-size: 0.95em;
        padding: 0.6em 1.2em;
    }
    #sf-dashboard {
        max-height: 180px; /* Slightly less height on mobile */
    }
}

@media (max-width: 480px) {
     .sf-modal .sf-modal-content {
         padding: 0.8em;
     }
    #sf-step-content h2 {
        font-size: 1.15em;
    }
     p.sf-trait-desc {
        font-size: 0.95em;
    }
     .sf-nav-btn, .sf-role-btn, .sf-action-btn {
        font-size: 0.9em;
        padding: 0.5em 1em;
    }
    .sf-result-card {
        padding: 0.8em;
    }
}

/* Form Actions (Save/Clear Buttons) */
.form-actions { display: flex; flex-wrap: wrap; gap: 1em; margin-top: 1.8em; justify-content: center; }
.save-btn, .clear-btn { border: none; padding: 0.8em 1.8em; font-size: 1.1em; border-radius: 50px; cursor: pointer; font-weight: bold; transition: transform 0.2s ease, background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.5em; }
.save-btn { background: var(--accent-color); color: var(--text-color-light); }
.save-btn:hover:not(:disabled) { background: var(--accent-color-darker); transform: translateY(-2px); box-shadow: var(--button-shadow); }
.clear-btn { background: var(--muted-text-color); color: var(--card-bg-color); }
.clear-btn:hover:not(:disabled) { background: var(--text-color); transform: translateY(-2px); box-shadow: var(--button-shadow); }
.save-btn:disabled, .clear-btn:disabled { background: color-mix(in srgb, var(--muted-text-color) 70%, transparent); color: color-mix(in srgb, var(--text-color-light) 70%, transparent); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
.save-btn.loading { cursor: wait; }

/* IMPROVEMENT: Style for the button text span */
.button-text {
    /* Add styles if needed, but mostly for JS targeting */
    display: inline-block; /* Ensure it behaves well with adjacent spinner */
}


/* ... (rest of styles) ... */

/* Achievements Panel Polish (Standalone Modal Version) */
.all-achievements-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.2em; padding: 0; margin-top: 1em; }
.all-achievements-list li { background: var(--bg-color); border: var(--border-width) solid var(--border-color); border-left: 6px solid var(--muted-text-color); padding: 1.2em; border-radius: var(--border-radius-small); display: flex; align-items: center; gap: 1em; transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), transform 0.2s ease; }
.all-achievements-list li:hover { transform: translateY(-2px); box-shadow: var(--card-shadow); }
.all-achievements-list li.locked { opacity: 0.65; border-left-color: color-mix(in srgb, var(--muted-text-color) 50%, transparent); }
.all-achievements-list li.unlocked { border-left-color: var(--achievement-color); background-color: color-mix(in srgb, var(--achievement-color) 10%, var(--bg-color)); }
html[data-theme="dark"] .all-achievements-list li.unlocked, html[data-theme="velvet"] .all-achievements-list li.unlocked { border-left-color: var(--achievement-color); background-color: color-mix(in srgb, var(--achievement-color) 12%, var(--bg-color)); }
html[data-theme="pastel"] .all-achievements-list li.unlocked { background-color: color-mix(in srgb, var(--achievement-color) 15%, var(--bg-color)); }
.all-achievements-list .achievement-icon { font-size: 2.2em; flex-shrink: 0; line-height: 1; }
.all-achievements-list .achievement-details { display: flex; flex-direction: column; flex-grow: 1; /* Allow details to take space */ }
.all-achievements-list .achievement-name { font-weight: bold; font-size: 1.05em; color: var(--accent-color-darker); margin-bottom: 0.2em; }
.all-achievements-list li.locked .achievement-name { color: var(--text-color); }
.all-achievements-list .achievement-desc { font-size: 0.9em; color: var(--text-color); line-height: 1.5; }
.all-achievements-list li.locked .achievement-desc { color: var(--muted-text-color); font-style: italic; }


/* FIX: Add styles for persona achievement list in insights */
.persona-achievements-list { display: flex; flex-wrap: wrap; gap: 0.8em; margin-top: 0.5em; padding-left: 0; justify-content: flex-start; list-style: none; }
.persona-achievements-list li { background: var(--bg-color); border: var(--border-width) solid var(--border-color); padding: 0.5em 0.8em; border-radius: var(--border-radius-medium); text-align: center; display: flex; align-items: center; gap: 0.4em; min-width: 90px; transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing), transform 0.1s ease; cursor: default; }
.persona-achievements-list li:hover { transform: translateY(-1px); border-color: var(--accent-color-light); }
.persona-achievements-list .achievement-icon { font-size: 1.2em; line-height: 1; }
.persona-achievements-list .achievement-name { font-weight: bold; font-size: 0.8em; line-height: 1.2; }
.persona-achievements-list li.no-border { border: none; background: none; box-shadow: none; padding: 0; width: 100%; text-align: center; display: block; }
.persona-achievements-list li.view-all-link { margin-top: 0.5em; } /* Style the 'View All' link container if needed */

