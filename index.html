--- START OF FILE index.html ---

<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸŒŸ KinkCompass Reimagined ğŸŒŸ</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§­</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>
    <header class="app-header">
        <h1><span role="img" aria-label="Compass">ğŸ§­</span> KinkCompass <span role="img" aria-label="Sparkles">âœ¨</span></h1>
        <nav class="header-nav" aria-label="Main navigation">
            <button type="button" id="style-finder-trigger-btn" class="header-btn" title="Find Your Kink Style!">ğŸ§­ Style Finder</button>
            <button type="button" id="style-discovery-btn" class="header-btn" title="Explore All Styles">ğŸ”­ Explore Styles</button>
            <button type="button" id="achievements-btn" class="header-btn" title="View Achievements">ğŸ† Achievements</button>
            <button type="button" id="glossary-btn" class="header-btn" title="Kink Glossary">ğŸ“š Glossary</button>
            <button type="button" id="resources-btn" class="header-btn" title="Helpful Resources">ğŸ”— Resources</button>
            <button type="button" id="themes-btn" class="header-btn" title="Change Theme">ğŸ¨ Themes</button>
            <button type="button" id="export-btn" class="header-btn" title="Export Data">ğŸ’¾ Export</button>
            <button type="button" id="import-btn" class="header-btn" title="Import Data">ğŸ“ Import</button>
            <input type="file" id="import-file-input" accept=".json" style="display: none;" aria-hidden="true" />
            <button type="button" id="theme-toggle" class="header-btn theme-btn" title="Toggle light/dark mode" aria-label="Switch to Dark Mode">ğŸŒ™</button>
        </nav>
    </header>

    <main class="container">

        <!-- Profile Creation/Editing Form -->
        <section id="form-section" class="form-section card" aria-labelledby="form-title">
            <h2 id="form-title">âœ¨ Create New Persona âœ¨</h2>
            <form action="#">
                <div class="field-group avatar-group">
                    <fieldset class="avatar-picker-fieldset">
                        <legend>Avatar:</legend>
                        <div class="avatar-picker">
                            <span id="avatar-display" aria-hidden="true">â“</span>
                            <input type="hidden" id="avatar-input" value="â“">
                            <button type="button" class="avatar-btn" data-emoji="ğŸ€" aria-label="Ribbon">ğŸ€</button>
                            <button type="button" class="avatar-btn" data-emoji="âœ¨" aria-label="Sparkles">âœ¨</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ’–" aria-label="Sparkling Heart">ğŸ’–</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ”¥" aria-label="Fire">ğŸ”¥</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ˜ˆ" aria-label="Devil">ğŸ˜ˆ</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ˜‡" aria-label="Angel">ğŸ˜‡</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ¶" aria-label="Dog">ğŸ¶</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ¦Š" aria-label="Fox">ğŸ¦Š</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ‘‘" aria-label="Crown">ğŸ‘‘</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ­" aria-label="Masks">ğŸ­</button>
                            <button type="button" class="avatar-btn" data-emoji="â›“ï¸" aria-label="Chains">â›“ï¸</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ—ï¸" aria-label="Key">ğŸ—ï¸</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸŒ¹" aria-label="Rose">ğŸŒ¹</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ“" aria-label="Strawberry">ğŸ“</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸŒ™" aria-label="Moon">ğŸŒ™</button>
                            <button type="button" class="avatar-btn" data-emoji="â­" aria-label="Star">â­</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ’" aria-label="Gem">ğŸ’</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ–¤" aria-label="Black Heart">ğŸ–¤</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ¤" aria-label="White Heart">ğŸ¤</button>
                            <button type="button" class="avatar-btn" data-emoji="ğŸ’œ" aria-label="Purple Heart">ğŸ’œ</button>
                            <button type="button" class="avatar-btn selected" data-emoji="â“" aria-label="Question Mark">â“</button>
                        </div>
                    </fieldset>
                </div>
                <div class="field-group">
                    <label for="name">Name</label>
                    <input type="text" id="name" placeholder="Persona Name (e.g., Playful Kitten)" autocomplete="off" required aria-required="true" />
                </div>
                <div class="field-group">
                    <label for="role">Primary Role</label>
                    <select id="role" autocomplete="off" required aria-required="true">
                        <option value="submissive" selected>Submissive</option>
                        <option value="dominant">Dominant</option>
                         <option value="switch">Switch</option>
                    </select>
                </div>
                <div class="field-group">
                    <label for="style">Primary Style</label>
                    <select id="style" autocomplete="off" required aria-required="true" aria-describedby="style-helper-text">
                        <option value="">-- Select Role First --</option>
                        <!-- Options populated by JS -->
                    </select>
                     <div class="style-helpers" id="style-helper-text">
                         <button type="button" id="form-style-finder-link" class="link-button">Use Style Finder?</button>
                         <!-- FIX: Changed <a> to <button> -->
                         <button type="button" id="style-explore-link" class="link-button explore-style-link" style="display: none;" aria-label="Explore selected style details">(Explore Details)</button>
                     </div>
                </div>

                <!-- Traits Area -->
                <div id="traits-message" class="muted-text" style="display: none; margin-top: 1.5em; text-align: center;">
                    Select Role & Style above to customize traits.
                </div>
                <div id="traits-container" style="display: block;" aria-live="polite">
                   <p class="muted-text" style="margin-top: 1.5em; text-align: center;">Select Role & Style to see relevant traits...</p>
                   <!-- Trait sliders generated by JS -->
                </div>

                <!-- Trait Info Popup (hidden initially) -->
                <div id="trait-info-popup" class="trait-info-popup card" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="trait-info-title" aria-hidden="true">
                    <button type="button" id="trait-info-close" class="modal-close popup-close" aria-label="Close trait info">Ã—</button>
                    <h4 id="trait-info-title">Trait Info</h4>
                    <div id="trait-info-body">
                        <!-- Content injected by JS -->
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button id="save" class="save-btn">
                        <span class="button-text">Save Persona! <span role="img" aria-label="Sparkles">ğŸ’–</span> </span>
                        <span class="spinner" style="display: none;" aria-hidden="true"></span>
                    </button>
                    <button type="button" id="clear-form" class="clear-btn">Clear Form <span role="img" aria-label="Broom">ğŸ§¹</span></button>
                </div>
            </form>
        </section>

        <!-- Persona List -->
        <section class="list-section card" aria-labelledby="persona-list-title">
            <h2 id="persona-list-title">ğŸŒŸ Persona Crew ğŸŒŸ</h2>
            <p class="muted-text">Click a persona to view details or edit.</p>
            <ul id="people-list" aria-live="polite">
                <li role="status" aria-live="polite">Loading personas...</li>
                <!-- Persona list items generated by JS -->
            </ul>
        </section>

        <!-- Live Preview Section -->
        <section class="preview-section card" aria-labelledby="live-preview-title">
            <h2 id="live-preview-title">ğŸˆ Live Vibe Preview ğŸˆ</h2>
            <div id="live-preview" aria-live="polite">
                <p class="muted-text">Fill the form to see your persona's vibe! ğŸŒˆ</p>
                 <!-- JS will insert dynamic content here -->
            </div>
        </section>
    </main>

    <!-- MODALS -->

    <!-- Persona Detail Modal -->
    <div class="modal" id="detail-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="detail-modal-title" aria-hidden="true">
        <div class="modal-content card wide-modal">
            <button type="button" class="modal-close" id="modal-close" aria-label="Close details">Ã—</button>
            <h2 class="modal-title" id="detail-modal-title">Persona Details</h2>
            <div class="modal-tabs" id="modal-tabs" role="tablist" aria-orientation="horizontal" aria-label="Persona details sections">
                <!-- Tabs generated by JS -->
            </div>
            <div id="modal-body">
                <div role="status" aria-live="polite">Loading details...</div>
                <!-- Tab content panes generated by JS -->
            </div>
        </div>
    </div>

    <!-- Resources Modal -->
    <div class="modal" id="resources-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="resources-modal-title" aria-hidden="true">
        <div class="modal-content card">
            <button type="button" class="modal-close" id="resources-close" aria-label="Close resources">Ã—</button>
            <h2 id="resources-modal-title">ğŸ”— Helpful Resources</h2>
            <div id="resources-body">
                 <p>Expand your knowledge and connect safely. Always practice enthusiastic consent, communicate clearly, and prioritize well-being.</p>
                 <dl>
                    <dt>Consent Models</dt>
                    <dd>
                        <ul>
                            <li><strong>SSC:</strong> Safe, Sane, Consensual. A baseline, ensure activities are physically safe, mentally sound, and agreed upon.</li>
                            <li><strong>RACK:</strong> Risk-Aware Consensual Kink. Acknowledges inherent risks in some activities, emphasizing understanding and acceptance of those risks.</li>
                            <li><strong>FRIES:</strong> Freely given, Reversible, Informed, Enthusiastic, Specific. A great checklist for ongoing consent.</li>
                        </ul>
                         Search online for detailed explanations of each.
                    </dd>
                    <dt>Negotiation & Communication</dt>
                    <dd>
                        <ul>
                            <li>Discuss limits (hard/soft), desires, safewords, aftercare needs *before* play.</li>
                            <li>Use "I feel" statements to express needs without blame.</li>
                            <li>Practice active listening to truly understand your partner(s).</li>
                            <li>Check in during and after scenes.</li>
                        </ul>
                    </dd>
                    <dt>Safety Information</dt>
                    <dd>
                        <ul>
                            <li>Research specific practices (e.g., rope safety, impact play zones, breath play risks, electrical play precautions).</li>
                            <li>Understand basic first aid relevant to potential activities.</li>
                            <li>Look for resources from reputable organizations like the National Coalition for Sexual Freedom (NCSF).</li>
                        </ul>
                     </dd>
                    <dt>Community & Education</dt>
                    <dd>
                        <ul>
                            <li><strong>FetLife:</strong> Large social network (use with caution, vet carefully).</li>
                            <li><strong>Local Munches/Events:</strong> Search for community events in your area (vet carefully).</li>
                            <li><strong>Educational Workshops:</strong> Many communities offer classes on specific skills or topics.</li>
                        </ul>
                    </dd>
                    <dt>Mental Health & Support</dt>
                    <dd>
                         <ul>
                             <li><strong>Kink Aware Professionals (KAP):</strong> Directory via Kapprofessionals.com or similar listings to find therapists familiar with kink/BDSM dynamics.</li>
                             <li>Peer support groups (online or local).</li>
                             <li>Recognize sub/dom drop and prioritize aftercare.</li>
                         </ul>
                    </dd>
                 </dl>
                 <hr>
                 <p class="disclaimer"><em>Disclaimer: KinkCompass provides pointers only and does not endorse specific resources, organizations, or practices. Your safety, well-being, and choices are your responsibility. Research thoroughly, communicate clearly, and practice responsibly.</em></p>
            </div>
        </div>
    </div>

    <!-- Glossary Modal -->
    <div class="modal" id="glossary-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="glossary-modal-title" aria-hidden="true">
        <div class="modal-content card wide-modal">
            <button type="button" class="modal-close" id="glossary-close" aria-label="Close glossary">Ã—</button>
            <h2 id="glossary-modal-title">ğŸ“š Kink Glossary</h2>
            <div class="glossary-search">
                <label for="glossary-search-input" class="sr-only">Search Glossary</label>
                <input type="search" id="glossary-search-input" placeholder="Search terms..." />
                <button type="button" id="glossary-search-clear" class="small-btn clear-btn" aria-label="Clear search">âœ•</button>
            </div>
            <div id="glossary-body">
                <p class="muted-text" role="status" aria-live="polite">Loading glossary terms...</p>
                <!-- Glossary content generated by JS -->
            </div>
        </div>
    </div>

    <!-- Style Discovery Modal -->
    <div class="modal" id="style-discovery-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="style-discovery-title" aria-hidden="true">
        <div class="modal-content card wide-modal">
            <button type="button" class="modal-close" id="style-discovery-close" aria-label="Close style discovery">Ã—</button>
            <h2 id="style-discovery-title">ğŸ”­ Explore Styles</h2>
            <div class="style-discovery-controls">
                <label for="style-discovery-role">Filter by Role:</label>
                <select id="style-discovery-role">
                    <option value="all">All Roles</option>
                    <option value="submissive">Submissive</option>
                    <option value="dominant">Dominant</option>
                    <option value="switch">Switch</option>
                </select>
                <div class="style-discovery-search">
                    <label for="style-discovery-search-input" class="sr-only">Search Styles</label>
                    <input type="search" id="style-discovery-search-input" placeholder="Search styles..." />
                </div>
            </div>
            <div id="style-discovery-body">
                <p class="muted-text" role="status" aria-live="polite">Loading styles...</p>
                <!-- Style discovery content generated by JS -->
            </div>
        </div>
    </div>

    <!-- Themes Modal -->
    <div class="modal" id="themes-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="themes-modal-title" aria-hidden="true">
        <div class="modal-content card">
            <button type="button" class="modal-close" id="themes-close" aria-label="Close themes">Ã—</button>
            <h2 id="themes-modal-title">ğŸ¨ Select Theme</h2>
            <div id="themes-body" class="theme-options">
                <button type="button" class="theme-option-btn" data-theme="light">ğŸŒ¸ Light</button>
                <button type="button" class="theme-option-btn" data-theme="dark">ğŸŒ™ Dark</button>
                <button type="button" class="theme-option-btn" data-theme="pastel">ğŸ¬ Pastel</button>
                <button type="button" class="theme-option-btn" data-theme="velvet">ğŸ’œ Velvet</button>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div class="modal" id="achievements-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="achievements-modal-title" aria-hidden="true">
        <div class="modal-content card wide-modal">
            <button type="button" class="modal-close" id="achievements-close" aria-label="Close achievements">Ã—</button>
            <h2 id="achievements-modal-title">ğŸ† Achievements Hub ğŸ†</h2>
            <div id="achievements-body">
                <p class="muted-text" role="status" aria-live="polite">Loading achievements status...</p>
                <!-- Achievements list generated by JS -->
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div class="modal" id="welcome-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="welcome-modal-title" aria-hidden="true">
        <div class="modal-content card">
            <button type="button" class="modal-close" id="welcome-close" aria-label="Close welcome message">Ã—</button>
            <h2 id="welcome-modal-title">Welcome to KinkCompass! âœ¨ğŸ§­</h2>
            <div id="welcome-body">
                 <p>Your journey to understanding and tracking your desires starts here!</p>
                 <p><strong>Quick Start:</strong></p>
                 <ol style="list-style: decimal; padding-left: 1.5em;">
                    <li>Use the form on the left to <strong>Create a Persona</strong>.</li>
                    <li>Explore the <strong>Style Finder</strong> (ğŸ§­ button in header) for guidance.</li>
                    <li>Click personas in the list to view <strong>Details</strong>, track goals, and reflect.</li>
                    <li>Check out the <strong>Glossary</strong> (ğŸ“š) & <strong>Resources</strong> (ğŸ”—) in the header.</li>
                 </ol>
                 <p>Ready to explore? Close this message to begin!</p>
            </div>
        </div>
    </div>

    <!-- Style Finder Modal -->
    <div class="modal sf-modal" id="style-finder-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="sf-modal-title" aria-hidden="true">
        <div class="modal-content sf-modal-content card">
            <button type="button" class="modal-close" id="sf-close-style-finder" aria-label="Close Style Finder">Ã—</button>
            <h3 id="sf-modal-title">ğŸ§­ Style Finder Quest ğŸ§­</h3>
            <div id="sf-progress-tracker" class="sf-progress-tracker" aria-live="polite">Step 0 of 0</div>
            <div id="sf-progress-bar-container" aria-hidden="true"><div id="sf-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div></div>
            <div id="sf-step-content" role="region" aria-live="polite">
                <p>Loading your quest...</p>
                <!-- Style Finder steps generated by JS -->
            </div>
            <p id="sf-feedback" class="sf-feedback" aria-live="assertive"></p>
            <div id="sf-dashboard" class="sf-dashboard" style="display:none;" aria-live="polite">
                <!-- Style Finder dashboard generated by JS -->
            </div>
        </div>
    </div>

     <!-- Generic Context Help Popup -->
     <div id="context-help-popup" class="context-help-popup card" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="context-help-title" aria-hidden="true">
        <button type="button" id="context-help-close" class="modal-close popup-close" aria-label="Close help">Ã—</button>
        <h4 id="context-help-title">Help</h4>
        <div id="context-help-body">
            <!-- Content injected by JS -->
        </div>
    </div>

    <!-- App Notification Area -->
     <div id="app-notification" style="opacity: 0; top: 20px;" role="status" aria-live="assertive" aria-hidden="true">
         <!-- Notifications populated by JS -->
     </div>


    <footer class="app-footer">
        <p>KinkCompass Reimagined - Navigate your desires with clarity & joy! âœ¨</p>
        <p><small>Version 2.8.8 (Corrected)</small></p>
    </footer>

    <!-- SCRIPTS -->
    <script type="module" src="app.js"></script>

</body>
</html>
